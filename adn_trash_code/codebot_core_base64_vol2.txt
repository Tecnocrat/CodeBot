lQm90OiBIZWxsbywgSSdtIENvZGVCb3QhIikNCiAgICAgICAgZWxpZiB1c2VyX2lucHV0IGluIFsicXVpdCJdOg0KICAgICAgICAgICAgcHJpbnQoIkNvZGVCb3Q6IEdvb2RieWUhIikNCiAgICAgICAgICAgIGJyZWFrDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICAjIFJlY29nbml6ZSB3b3JkcyBmcm9tIHRoZSBpbnB1dCB1c2luZyB0aGUgZGljdGlvbmFyeQ0KICAgICAgICAgICAgcmVjb2duaXplZCA9IHdvcmRfcmVjb2duaXRpb24odXNlcl9pbnB1dCkNCiAgICAgICAgICAgIGlmIHJlY29nbml6ZWQ6DQogICAgICAgICAgICAgICAgcHJpbnQoZiJDb2RlQm90OiBJIHJlY29nbml6ZWQgdGhlc2Ugd29yZHM6IHsnLCAnLmpvaW4ocmVjb2duaXplZCl9IikNCiAgICAgICAgICAgICAgICAjIFN1Z2dlc3Qgc2ltaWxhciB3b3JkcyBmb3IgdGhlIGZpcnN0IHJlY29nbml6ZWQgd29yZA0KICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zID0gc3VnZ2VzdF93b3JkKGxpc3QocmVjb2duaXplZClbMF0pDQogICAgICAgICAgICAgICAgaWYgc3VnZ2VzdGlvbnM6DQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiQ29kZUJvdDogSGVyZSBhcmUgc29tZSB3b3JkIHN1Z2dlc3Rpb25zOiB7JywgJy5qb2luKHN1Z2dlc3Rpb25zKX0iKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludCgiQ29kZUJvdDogSSBkaWRuJ3QgcmVjb2duaXplIGFueSB2YWxpZCB3b3Jkcy4gVHJ5IGFnYWluISIpDQoNCiAgICAgICAgIyBTdGFuZGJ5IGRlbGF5IGFmdGVyIGVhY2ggdXNlciBpbnRlcmFjdGlvbg0KICAgICAgICB0aW1lLnNsZWVwKDAuNSkNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCiMgUFJPSkVDVCBTVFJVQ1RVUkUgQU5EIE1PRFVMQVJJWkFUSU9OIEZVTkNUSU9OUw0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCmRlZiBzZXR1cF9wcm9qZWN0X3N0cnVjdHVyZShiYXNlX2ZvbGRlcj0iQ29kZUJvdCIsIG1vZHVsZXNfZm9sZGVyPSJtb2R1bGVzIiwgdGFyZ2V0X2ZvbGRlcj0iLi4vYWRuX3RyYXNoX2NvZGUiKToNCiAgICBvcy5tYWtlZGlycyhiYXNlX2ZvbGRlciwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICBtb2R1bGVzX3BhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9mb2xkZXIsIG1vZHVsZXNfZm9sZGVyKQ0KICAgIG9zLm1ha2VkaXJzKG1vZHVsZXNfcGF0aCwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICB0YXJnZXRfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUoYmFzZV9mb2xkZXIpLCAiYWRuX3RyYXNoX2NvZGUiKQ0KICAgIG9zLm1ha2VkaXJzKHRhcmdldF9wYXRoLCBleGlzdF9vaz1UcnVlKQ0KICAgIHByaW50KGYiQ3JlYXRlZCBmb2xkZXJzOiB7bW9kdWxlc19wYXRofSwge3RhcmdldF9wYXRofSIpDQogICAgaW5pdGlhbF9maWxlcyA9IFsiZnVuY3Rpb25zLnB5IiwgInN1bW1hcml6YXRpb24ucHkiLCAiY29tcHJlc3Npb24ucHkiLCAicmVzb3VyY2VzLnB5IiwgImZpbGVfbWFuYWdlci5weSJdDQogICAgZm9yIGZpbGUgaW4gaW5pdGlhbF9maWxlczoNCiAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKG1vZHVsZXNfcGF0aCwgZmlsZSkNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6DQogICAgICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAidyIpIGFzIGY6DQogICAgICAgICAgICAgICAgZi53cml0ZShmIiMgUGxhY2Vob2xkZXIgZm9yIHtmaWxlfVxuIikNCiAgICAgICAgICAgIHByaW50KGYiQ3JlYXRlZCBmaWxlOiB7ZmlsZV9wYXRofSIpDQogICAgcHJpbnQoIlByb2plY3Qgc3RydWN0dXJlIHNldHVwIGNvbXBsZXRlISIpDQoNCmRlZiBtb2R1bGFyaXplX2Z1bmN0aW9ucyhtb2R1bGVzX2ZvbGRlcj0ibW9kdWxlcyIsIG1haW5fc2NyaXB0PU5vbmUpOg0KICAgIGlmIG1haW5fc2NyaXB0IGlzIE5vbmU6DQogICAgICAgIG1haW5fc2NyaXB0ID0gb3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKQ0KICAgIGlmIG5vdCBvcy5wYXRoLmlzZGlyKG1vZHVsZXNfZm9sZGVyKToNCiAgICAgICAgYWx0ZXJuYXRpdmUgPSBvcy5wYXRoLmpvaW4oIkNvZGVCb3QiLCBtb2R1bGVzX2ZvbGRlcikNCiAgICAgICAgaWYgb3MucGF0aC5pc2RpcihhbHRlcm5hdGl2ZSk6DQogICAgICAgICAgICBtb2R1bGVzX2ZvbGRlciA9IGFsdGVybmF0aXZlDQogICAgbW9kdWxlX21hcHBpbmcgPSB7DQogICAgICAgICJnZW5lcmF0ZV9zeW1ib2xfbGlicmFyeSI6ICJmdW5jdGlvbnMucHkiLA0KICAgICAgICAic3VtbWFyaXplX3J1bnRpbWUiOiAic3VtbWFyaXphdGlvbi5weSIsDQogICAgICAgICJjb21wcmVzc19saWJyYXJpZXMiOiAiY29tcHJlc3Npb24ucHkiLA0KICAgICAgICAiZGVjb21wcmVzc19saWJyYXJ5IjogImNvbXByZXNzaW9uLnB5IiwNCiAgICAgICAgIm1vbml0b3JfcmVzb3VyY2VzIjogInJlc291cmNlcy5weSIsDQogICAgICAgICJzZXR1cF9wcm9qZWN0X3N0cnVjdHVyZSI6ICJmaWxlX21hbmFnZXIucHkiDQogICAgfQ0KICAgIHByaW50KCJcbk1vZHVsYXJpemluZyBmdW5jdGlvbnMgZnJvbSB0aGUgbWFpbiBzY3JpcHQuLi4iKQ0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKG1haW5fc2NyaXB0LCAiciIpIGFzIG1haW5fZmlsZToNCiAgICAgICAgICAgIG1haW5fbGluZXMgPSBtYWluX2ZpbGUucmVhZGxpbmVzKCkNCiAgICAgICAgZm9yIGZ1bmNfbmFtZSwgbW9kdWxlX2ZpbGUgaW4gbW9kdWxlX21hcHBpbmcuaXRlbXMoKToNCiAgICAgICAgICAgIG1vZHVsZV9wYXRoID0gb3MucGF0aC5qb2luKG1vZHVsZXNfZm9sZGVyLCBtb2R1bGVfZmlsZSkNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG1vZHVsZV9wYXRoKToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4obW9kdWxlX3BhdGgsICJyIikgYXMgbW9kdWxlOg0KICAgICAgICAgICAgICAgICAgICBtb2R1bGVfY29udGVudCA9IG1vZHVsZS5yZWFkKCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgbW9kdWxlX2NvbnRlbnQgPSAiIg0KICAgICAgICAgICAgd2l0aCBvcGVuKG1vZHVsZV9wYXRoLCAiYSIpIGFzIG1vZHVsZToNCiAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBtYWluX2xpbmVzOg0KICAgICAgICAgICAgICAgICAgICBpZiBmImRlZiB7ZnVuY19uYW1lfSIgaW4gbGluZSBhbmQgZiJkZWYge2Z1bmNfbmFtZX0iIG5vdCBpbiBtb2R1bGVfY29udGVudDoNCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS53cml0ZShsaW5lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJNb3ZlZCB7ZnVuY19uYW1lfSB0byB7bW9kdWxlX2ZpbGV9IikNCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6DQogICAgICAgIHByaW50KGYiTWFpbiBzY3JpcHQgJ3ttYWluX3NjcmlwdH0nIG5vdCBmb3VuZC4gQ2Fubm90IG1vZHVsYXJpemUgZnVuY3Rpb25zLiIpDQoNCmRlZiBjb21wcmVzc19hbmRfZW5jb2RlX3NjcmlwdChzY3JpcHRfcGF0aD1Ob25lLCB6aXBfbmFtZT0iY29kZWJvdF9jb3JlLnppcCIsIG91dHB1dF9maWxlX2Jhc2U9ImNvZGVib3RfY29yZV9iYXNlNjRfdm9sIik6DQogICAgaWYgc2NyaXB0X3BhdGggaXMgTm9uZToNCiAgICAgICAgc2NyaXB0X3BhdGggPSBvcy5wYXRoLmFic3BhdGgoX19maWxlX18pDQogICAgemlwX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgemlwX25hbWUpDQogICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoemlwX3BhdGgsICJ3IikgYXMgemlwZjoNCiAgICAgICAgemlwZi53cml0ZShzY3JpcHRfcGF0aCwgYXJjbmFtZT0iY29kZWJvdF9jb3JlLnB5IikNCiAgICBwcmludChmIlNjcmlwdCBjb21wcmVzc2VkIGludG86IHt6aXBfbmFtZX0iKQ0KICAgIHdpdGggb3Blbih6aXBfcGF0aCwgInJiIikgYXMgemlwX2ZpbGU6DQogICAgICAgIGVuY29kZWQgPSBiYXNlNjQuYjY0ZW5jb2RlKHppcF9maWxlLnJlYWQoKSkuZGVjb2RlKCJ1dGYtOCIpDQogICAgdm9sdW1lX2ZpbGVzID0gc3BsaXRfYW5kX3NhdmVfYmFzZTY0KGVuY29kZWQsIHZvbHVtZV9iYXNlPW91dHB1dF9maWxlX2Jhc2UsIGNodW5rX3NpemU9OTk5OSkNCiAgICBwcmludCgiQmFzZTY0LWVuY29kZWQgc2NyaXB0IGhhcyBiZWVuIHNwbGl0IGludG8gdm9sdW1lcy4iKQ0KICAgIHJldHVybiB2b2x1bWVfZmlsZXMNCg0KZGVmIHNwbGl0X2FuZF9zYXZlX2Jhc2U2NChlbmNvZGVkX3RleHQsIHZvbHVtZV9iYXNlPSJjb2RlYm90X2NvcmVfYmFzZTY0X3ZvbCIsIGNodW5rX3NpemU9OTk5OSk6DQogICAgdm9sdW1lcyA9IFtlbmNvZGVkX3RleHRbaTppK2NodW5rX3NpemVdIGZvciBpIGluIHJhbmdlKDAsIGxlbihlbmNvZGVkX3RleHQpLCBjaHVua19zaXplKV0NCiAgICB2b2x1bWVfZmlsZXMgPSBbXQ0KICAgIGZvciBpbmRleCwgY2h1bmsgaW4gZW51bWVyYXRlKHZvbHVtZXMsIHN0YXJ0PTEpOg0KICAgICAgICBmaWxlbmFtZSA9IGYie3ZvbHVtZV9iYXNlfXtpbmRleH0udHh0Ig0KICAgICAgICBvdXRwdXRfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCBmaWxlbmFtZSkNCiAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9wYXRoLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKGNodW5rKQ0KICAgICAgICB2b2x1bWVfZmlsZXMuYXBwZW5kKGZpbGVuYW1lKQ0KICAgICAgICBwcmludChmIlNhdmVkIFZvbHVtZSB7aW5kZXh9IHRvIHtmaWxlbmFtZX0iKQ0KICAgIHJldHVybiB2b2x1bWVfZmlsZXMNCg0KZGVmIHNjYW5fdGVzdF9mb2xkZXIoZm9sZGVyX3BhdGgpOg0KICAgICIiIg0KICAgIFNjYW5zIHRoZSB0ZXN0IGZvbGRlciBmb3IgYXZhaWxhYmxlIHRvb2xzIGFuZCByZXR1cm5zIGEgbGlzdCBvZiBmaWxlcy4NCiAgICAiIiINCiAgICByZXR1cm4gW2YgZm9yIGYgaW4gb3MubGlzdGRpcihmb2xkZXJfcGF0aCkgaWYgb3MucGF0aC5pc2ZpbGUob3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCBmKSldDQoNCmRlZiB3b3JkX3JlY29nbml0aW9uKGlucHV0X3RleHQsIGRpY3Rpb25hcnlfcGF0aD0iQzpcXGRldlxcYWRuX3RyYXNoX2NvZGVcXGRpY3Rpb25hcmllc1xcZW5nbGlzaF93b3Jkcy50eHQiKToNCiAgICAiIiINCiAgICBDaGVja3MgaWYgdGhlIGlucHV0IGNvbnRhaW5zIHZhbGlkIEVuZ2xpc2ggd29yZHMgZnJvbSB0aGUgZGljdGlvbmFyeS4NCiAgICAiIiINCiAgICB3aXRoIG9wZW4oZGljdGlvbmFyeV9wYXRoLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgIHdvcmRfbGlzdCA9IHNldChmLnJlYWQoKS5zcGxpdGxpbmVzKCkpDQogICAgDQogICAgaW5wdXRfd29yZHMgPSBzZXQoaW5wdXRfdGV4dC5sb3dlcigpLnNwbGl0KCkpDQogICAgcmVjb2duaXplZF93b3JkcyA9IGlucHV0X3dvcmRzLmludGVyc2VjdGlvbih3b3JkX2xpc3QpDQogICAgDQogICAgcmV0dXJuIHJlY29nbml6ZWRfd29yZHMNCg0KZGVmIHN1Z2dlc3Rfd29yZChpbnB1dF93b3JkLCBkaWN0aW9uYXJ5X3BhdGg9IkM6XFxkZXZcXGFkbl90cmFzaF9jb2RlXFxkaWN0aW9uYXJpZXNcXGVuZ2xpc2hfd29yZHMudHh0Iik6DQogICAgIiIiDQogICAgU3VnZ2VzdHMgd29yZHMgZnJvbSB0aGUgZGljdGlvbmFyeSB0aGF0IHN0YXJ0IHdpdGggdGhlIHNhbWUgbGV0dGVycyBhcyB0aGUgaW5wdXQgd29yZC4NCiAgICAiIiINCiAgICB3aXRoIG9wZW4oZGljdGlvbmFyeV9wYXRoLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgIHdvcmRfbGlzdCA9IFt3b3JkLnN0cmlwKCkgZm9yIHdvcmQgaW4gZi5yZWFkbGluZXMoKV0NCg0KICAgIHN1Z2dlc3Rpb25zID0gW3dvcmQgZm9yIHdvcmQgaW4gd29yZF9saXN0IGlmIHdvcmQuc3RhcnRzd2l0aChpbnB1dF93b3JkLmxvd2VyKCkpXQ0KICAgIHJldHVybiBzdWdnZXN0aW9uc1s6NV0gICMgUmV0dXJuIHVwIHRvIDUgc3VnZ2VzdGlvbnMNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCiMgTUFJTiBFWEVDVVRJT04NCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIHByaW50KCJcblN0ZXAgMTogU2V0dGluZyB1cCBwcm9qZWN0IHN0cnVjdHVyZS4uLiIpDQogICAgc2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUoKQ0KDQogICAgcHJpbnQoIlxuU3RlcCAyOiBNb2R1bGFyaXppbmcgZnVuY3Rpb25zLi4uIikNCiAgICBtb2R1bGFyaXplX2Z1bmN0aW9ucygpDQoNCiAgICByZXNvdXJjZV9tb25pdG9yX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW1vbml0b3JfcmVzb3VyY2VzLCBkYWVtb249VHJ1ZSkNCiAgICByZXNvdXJjZV9tb25pdG9yX3RocmVhZC5zdGFydCgpDQoNCiAgICBwcmludCgiXG5TdGVwIDM6IExhdW5jaGluZyBVSSBJbnRlcmZhY2UuLi4iKQ0KICAgIGxhdW5jaF91aSgpDQoNCiAgICBwcmludCgiXG5TdGVwIDQ6IENyZWF0aW5nIGtub3dsZWRnZSBhcmNoaXZlLi4uIikNCiAgICBjcmVhdGVfa25vd2xlZGdlX2FyY2hpdmUoIi4uL2Fkbl90cmFzaF9jb2RlIikNCg0KICAgIHByaW50KCJcblN0ZXAgNTogQ29tcHJlc3NpbmcgbGlicmFyaWVzLi4uIikNCiAgICBjb21wcmVzc19saWJyYXJpZXMoKQ0KDQogICAgcHJpbnQoIlxuU3RlcCA2OiBFbmNvZGluZyBtYWluIHNjcmlwdCB0byBCYXNlNjQgYW5kIHNwbGl0dGluZyBpbnRvIHZvbHVtZXMuLi4iKQ0KICAgIHZvbHVtZXNfY3JlYXRlZCA9IGNvbXByZXNzX2FuZF9lbmNvZGVfc2NyaXB0KCkNCiAgICBwcmludCgiVm9sdW1lcyBjcmVhdGVkOiIsIHZvbHVtZXNfY3JlYXRlZCkNCg0KICAgIHByaW50KCJcblN0ZXAgNzogVGVzdGluZyBkZWNvbXByZXNzaW9uIG9mIHJ1bnRpbWUgbGlicmFyeS4uLiIpDQogICAgZGVjb21wcmVzc19saWJyYXJ5KGZpbGVfdG9fZXh0cmFjdD0icnVudGltZV9saWJyYXJ5LnR4dCIpDQoNCiAgICBwcmludCgiXG5TdGVwIDg6IFNjYW4gdGVzdCBmb2xkZXIuLi4iKQ0KICAgIHRlc3RfdG9vbHMgPSBzY2FuX3Rlc3RfZm9sZGVyKCJDOlxcZGV2XFx0ZXN0IikNCiAgICBwcmludChmIkF2YWlsYWJsZSB0b29scyBpbiB0aGUgdGVzdCBmb2xkZXI6IHt0ZXN0X3Rvb2xzfSIpDQogICAgDQogICAgcHJpbnQoIlxuU3RlcCA5OiBHZW5lcmF0aW5nIHN5bWJvbCBsaWJyYXJ5Li4uIikNCiAgICBzYXZlX3dvcmRsaXN0cygiQzpcXGRldlxcYWRuX3RyYXNoX2NvZGVcXGRpY3Rpb25hcmllcyIpDQoNCiAgICAjIExvYWQgbGlicmFyaWVzIGZvciBQeXRob24NCiAgICBweXRob25fbGlicyA9IGxvYWRfbGFuZ3VhZ2VfbGlicmFyaWVzKGxhbmd1YWdlPSJweXRob24iKQ0KICAgIGlmIHB5dGhvbl9saWJzOg0KICAgICAgICBwcmludChmIlN0ZXAgMTA6IFRlYWNoaW5nIENvZGVCb3QgUHl0aG9uLi4uIikNCiAgICAgICAgZm9yIGxpYiBpbiBweXRob25fbGliczoNCiAgICAgICAgICAgIGFuYWx5emVfbGlicmFyeShvcy5wYXRoLmpvaW4oIkM6XFxkZXZcXGFkbl90cmFzaF9jb2RlXFxweXRob25fbGlicyIsIGxpYiksIGRlYnVnPUZhbHNlKQ0KDQogICAgIyBQbGFjZWhvbGRlciBmb3IgYWRkaXRpb25hbCBsYW5ndWFnZXMgKGUuZy4sIEphdm