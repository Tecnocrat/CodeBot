gICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmaWxlX3BhdGgpOg0KICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInciKSBhcyBmOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiIjIFBsYWNlaG9sZGVyIGZvciB7ZmlsZX1cbiIpDQogICAgICAgICAgICBwcmludChmIkNyZWF0ZWQgZmlsZToge2ZpbGVfcGF0aH0iKQ0KICAgIHByaW50KCJQcm9qZWN0IHN0cnVjdHVyZSBzZXR1cCBjb21wbGV0ZSEiKQ0KDQpkZWYgbW9kdWxhcml6ZV9mdW5jdGlvbnMobW9kdWxlc19mb2xkZXI9Im1vZHVsZXMiLCBtYWluX3NjcmlwdD1Ob25lKToNCiAgICBpZiBtYWluX3NjcmlwdCBpcyBOb25lOg0KICAgICAgICBtYWluX3NjcmlwdCA9IG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykNCiAgICBpZiBub3Qgb3MucGF0aC5pc2Rpcihtb2R1bGVzX2ZvbGRlcik6DQogICAgICAgIGFsdGVybmF0aXZlID0gb3MucGF0aC5qb2luKCJDb2RlQm90IiwgbW9kdWxlc19mb2xkZXIpDQogICAgICAgIGlmIG9zLnBhdGguaXNkaXIoYWx0ZXJuYXRpdmUpOg0KICAgICAgICAgICAgbW9kdWxlc19mb2xkZXIgPSBhbHRlcm5hdGl2ZQ0KICAgIG1vZHVsZV9tYXBwaW5nID0gew0KICAgICAgICAiZ2VuZXJhdGVfc3ltYm9sX2xpYnJhcnkiOiAiZnVuY3Rpb25zLnB5IiwNCiAgICAgICAgInN1bW1hcml6ZV9ydW50aW1lIjogInN1bW1hcml6YXRpb24ucHkiLA0KICAgICAgICAiY29tcHJlc3NfbGlicmFyaWVzIjogImNvbXByZXNzaW9uLnB5IiwNCiAgICAgICAgImRlY29tcHJlc3NfbGlicmFyeSI6ICJjb21wcmVzc2lvbi5weSIsDQogICAgICAgICJtb25pdG9yX3Jlc291cmNlcyI6ICJyZXNvdXJjZXMucHkiLA0KICAgICAgICAic2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUiOiAiZmlsZV9tYW5hZ2VyLnB5Ig0KICAgIH0NCiAgICBwcmludCgiXG5Nb2R1bGFyaXppbmcgZnVuY3Rpb25zIGZyb20gdGhlIG1haW4gc2NyaXB0Li4uIikNCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihtYWluX3NjcmlwdCwgInIiKSBhcyBtYWluX2ZpbGU6DQogICAgICAgICAgICBtYWluX2xpbmVzID0gbWFpbl9maWxlLnJlYWRsaW5lcygpDQogICAgICAgIGZvciBmdW5jX25hbWUsIG1vZHVsZV9maWxlIGluIG1vZHVsZV9tYXBwaW5nLml0ZW1zKCk6DQogICAgICAgICAgICBtb2R1bGVfcGF0aCA9IG9zLnBhdGguam9pbihtb2R1bGVzX2ZvbGRlciwgbW9kdWxlX2ZpbGUpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhtb2R1bGVfcGF0aCk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKG1vZHVsZV9wYXRoLCAiciIpIGFzIG1vZHVsZToNCiAgICAgICAgICAgICAgICAgICAgbW9kdWxlX2NvbnRlbnQgPSBtb2R1bGUucmVhZCgpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIG1vZHVsZV9jb250ZW50ID0gIiINCiAgICAgICAgICAgIHdpdGggb3Blbihtb2R1bGVfcGF0aCwgImEiKSBhcyBtb2R1bGU6DQogICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gbWFpbl9saW5lczoNCiAgICAgICAgICAgICAgICAgICAgaWYgZiJkZWYge2Z1bmNfbmFtZX0iIGluIGxpbmUgYW5kIGYiZGVmIHtmdW5jX25hbWV9IiBub3QgaW4gbW9kdWxlX2NvbnRlbnQ6DQogICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUud3JpdGUobGluZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiTW92ZWQge2Z1bmNfbmFtZX0gdG8ge21vZHVsZV9maWxlfSIpDQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOg0KICAgICAgICBwcmludChmIk1haW4gc2NyaXB0ICd7bWFpbl9zY3JpcHR9JyBub3QgZm91bmQuIENhbm5vdCBtb2R1bGFyaXplIGZ1bmN0aW9ucy4iKQ0KDQpkZWYgY29tcHJlc3NfYW5kX2VuY29kZV9zY3JpcHQoc2NyaXB0X3BhdGg9Tm9uZSwgemlwX25hbWU9ImNvZGVib3RfY29yZS56aXAiLCBvdXRwdXRfZmlsZV9iYXNlPSJjb2RlYm90X2NvcmVfYmFzZTY0X3ZvbCIpOg0KICAgIGlmIHNjcmlwdF9wYXRoIGlzIE5vbmU6DQogICAgICAgIHNjcmlwdF9wYXRoID0gb3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKQ0KICAgIHppcF9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIHppcF9uYW1lKQ0KICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKHppcF9wYXRoLCAidyIpIGFzIHppcGY6DQogICAgICAgIHppcGYud3JpdGUoc2NyaXB0X3BhdGgsIGFyY25hbWU9ImNvZGVib3RfY29yZS5weSIpDQogICAgcHJpbnQoZiJTY3JpcHQgY29tcHJlc3NlZCBpbnRvOiB7emlwX25hbWV9IikNCiAgICB3aXRoIG9wZW4oemlwX3BhdGgsICJyYiIpIGFzIHppcF9maWxlOg0KICAgICAgICBlbmNvZGVkID0gYmFzZTY0LmI2NGVuY29kZSh6aXBfZmlsZS5yZWFkKCkpLmRlY29kZSgidXRmLTgiKQ0KICAgIHZvbHVtZV9maWxlcyA9IHNwbGl0X2FuZF9zYXZlX2Jhc2U2NChlbmNvZGVkLCB2b2x1bWVfYmFzZT1vdXRwdXRfZmlsZV9iYXNlLCBjaHVua19zaXplPTk5OTkpDQogICAgcHJpbnQoIkJhc2U2NC1lbmNvZGVkIHNjcmlwdCBoYXMgYmVlbiBzcGxpdCBpbnRvIHZvbHVtZXMuIikNCiAgICByZXR1cm4gdm9sdW1lX2ZpbGVzDQoNCmRlZiBzcGxpdF9hbmRfc2F2ZV9iYXNlNjQoZW5jb2RlZF90ZXh0LCB2b2x1bWVfYmFzZT0iY29kZWJvdF9jb3JlX2Jhc2U2NF92b2wiLCBjaHVua19zaXplPTk5OTkpOg0KICAgIHZvbHVtZXMgPSBbZW5jb2RlZF90ZXh0W2k6aStjaHVua19zaXplXSBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZW5jb2RlZF90ZXh0KSwgY2h1bmtfc2l6ZSldDQogICAgdm9sdW1lX2ZpbGVzID0gW10NCiAgICBmb3IgaW5kZXgsIGNodW5rIGluIGVudW1lcmF0ZSh2b2x1bWVzLCBzdGFydD0xKToNCiAgICAgICAgZmlsZW5hbWUgPSBmInt2b2x1bWVfYmFzZX17aW5kZXh9LnR4dCINCiAgICAgICAgb3V0cHV0X3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgZi53cml0ZShjaHVuaykNCiAgICAgICAgdm9sdW1lX2ZpbGVzLmFwcGVuZChmaWxlbmFtZSkNCiAgICAgICAgcHJpbnQoZiJTYXZlZCBWb2x1bWUge2luZGV4fSB0byB7ZmlsZW5hbWV9IikNCiAgICByZXR1cm4gdm9sdW1lX2ZpbGVzDQoNCmRlZiBzY2FuX3Rlc3RfZm9sZGVyKGZvbGRlcl9wYXRoKToNCiAgICAiIiINCiAgICBTY2FucyB0aGUgdGVzdCBmb2xkZXIgZm9yIGF2YWlsYWJsZSB0b29scyBhbmQgcmV0dXJucyBhIGxpc3Qgb2YgZmlsZXMuDQogICAgIiIiDQogICAgcmV0dXJuIFtmIGZvciBmIGluIG9zLmxpc3RkaXIoZm9sZGVyX3BhdGgpIGlmIG9zLnBhdGguaXNmaWxlKG9zLnBhdGguam9pbihmb2xkZXJfcGF0aCwgZikpXQ0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCiMgTUFJTiBFWEVDVVRJT04NCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIHByaW50KCJcblN0ZXAgMTogU2V0dGluZyB1cCBwcm9qZWN0IHN0cnVjdHVyZS4uLiIpDQogICAgc2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUoKQ0KDQogICAgcHJpbnQoIlxuU3RlcCAyOiBNb2R1bGFyaXppbmcgZnVuY3Rpb25zLi4uIikNCiAgICBtb2R1bGFyaXplX2Z1bmN0aW9ucygpDQoNCiAgICByZXNvdXJjZV9tb25pdG9yX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW1vbml0b3JfcmVzb3VyY2VzLCBkYWVtb249VHJ1ZSkNCiAgICByZXNvdXJjZV9tb25pdG9yX3RocmVhZC5zdGFydCgpDQoNCiAgICBwcmludCgiXG5TdGVwIDM6IFJ1bnRpbWUgZXhlY3V0aW9uLi4uIikNCiAgICBydW50aW1lX2V4ZWN1dGlvbigpDQoNCiAgICBwcmludCgiXG5TdGVwIDQ6IENvbXByZXNzaW5nIGxpYnJhcmllcy4uLiIpDQogICAgY29tcHJlc3NfbGlicmFyaWVzKCkNCg0KICAgIHByaW50KCJcblN0ZXAgNTogRW5jb2RpbmcgbWFpbiBzY3JpcHQgdG8gQmFzZTY0IGFuZCBzcGxpdHRpbmcgaW50byB2b2x1bWVzLi4uIikNCiAgICB2b2x1bWVzX2NyZWF0ZWQgPSBjb21wcmVzc19hbmRfZW5jb2RlX3NjcmlwdCgpDQogICAgcHJpbnQoIlZvbHVtZXMgY3JlYXRlZDoiLCB2b2x1bWVzX2NyZWF0ZWQpDQoNCiAgICBwcmludCgiXG5TdGVwIDY6IFRlc3RpbmcgZGVjb21wcmVzc2lvbiBvZiBydW50aW1lIGxpYnJhcnkuLi4iKQ0KICAgIGRlY29tcHJlc3NfbGlicmFyeShmaWxlX3RvX2V4dHJhY3Q9InJ1bnRpbWVfbGlicmFyeS50eHQiKQ0KDQogICAgcHJpbnQoIlxuU3RlcCA3OiBTY2FuIHRlc3QgZm9sZGVyLi4uIikNCiAgICB0ZXN0X3Rvb2xzID0gc2Nhbl90ZXN0X2ZvbGRlcigiQzpcXGRldlxcdGVzdCIpDQogICAgcHJpbnQoZiJBdmFpbGFibGUgdG9vbHMgaW4gdGhlIHRlc3QgZm9sZGVyOiB7dGVzdF90b29sc30iKQ0KICAgIA0KICAgIHByaW50KCJcblN0ZXAgODogR2VuZXJhdGluZyBzeW1ib2wgbGlicmFyeS4uLiIpDQogICAgc2F2ZV93b3JkbGlzdHMoIkM6XFxkZXZcXGFkbl90cmFzaF9jb2RlXFxkaWN0aW9uYXJpZXMiKQ0KDQogICAgcHJpbnQoIlxuQWxsIHRhc2tzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuIikNClBLAQIUABQAAAAAABxLd1rndPBx6i4AAOouAAAPAAAAAAAAAAAAAAC2gQAAAABjb2RlYm90X2NvcmUucHlQSwUGAAAAAAEAAQA9AAAAFy8AAAAA