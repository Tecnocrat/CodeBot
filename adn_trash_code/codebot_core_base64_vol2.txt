zZToNCiAgICAgICAgICAgICMgUmVjb2duaXplIHdvcmRzIGZyb20gdGhlIGlucHV0IHVzaW5nIHRoZSBkaWN0aW9uYXJ5DQogICAgICAgICAgICByZWNvZ25pemVkID0gd29yZF9yZWNvZ25pdGlvbih1c2VyX2lucHV0KQ0KICAgICAgICAgICAgaWYgcmVjb2duaXplZDoNCiAgICAgICAgICAgICAgICBwcmludChmIkNvZGVCb3Q6IEkgcmVjb2duaXplZCB0aGVzZSB3b3JkczogeycsICcuam9pbihyZWNvZ25pemVkKX0iKQ0KICAgICAgICAgICAgICAgICMgU3VnZ2VzdCBzaW1pbGFyIHdvcmRzIGZvciB0aGUgZmlyc3QgcmVjb2duaXplZCB3b3JkDQogICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBzdWdnZXN0X3dvcmQobGlzdChyZWNvZ25pemVkKVswXSkNCiAgICAgICAgICAgICAgICBpZiBzdWdnZXN0aW9uczoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJDb2RlQm90OiBIZXJlIGFyZSBzb21lIHdvcmQgc3VnZ2VzdGlvbnM6IHsnLCAnLmpvaW4oc3VnZ2VzdGlvbnMpfSIpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50KCJDb2RlQm90OiBJIGRpZG4ndCByZWNvZ25pemUgYW55IHZhbGlkIHdvcmRzLiBUcnkgYWdhaW4hIikNCg0KICAgICAgICAjIFN0YW5kYnkgZGVsYXkgYWZ0ZXIgZWFjaCB1c2VyIGludGVyYWN0aW9uDQogICAgICAgIHRpbWUuc2xlZXAoMC41KQ0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBQUk9KRUNUIFNUUlVDVFVSRSBBTkQgTU9EVUxBUklaQVRJT04gRlVOQ1RJT05TDQojIC0tLS0tLS0tLS0tLS0tLS0tLQ0KZGVmIHNldHVwX3Byb2plY3Rfc3RydWN0dXJlKGJhc2VfZm9sZGVyPSJDb2RlQm90IiwgbW9kdWxlc19mb2xkZXI9Im1vZHVsZXMiLCB0YXJnZXRfZm9sZGVyPSIuLi9hZG5fdHJhc2hfY29kZSIpOg0KICAgIG9zLm1ha2VkaXJzKGJhc2VfZm9sZGVyLCBleGlzdF9vaz1UcnVlKQ0KICAgIG1vZHVsZXNfcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX2ZvbGRlciwgbW9kdWxlc19mb2xkZXIpDQogICAgb3MubWFrZWRpcnMobW9kdWxlc19wYXRoLCBleGlzdF9vaz1UcnVlKQ0KICAgIHRhcmdldF9wYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZGlybmFtZShiYXNlX2ZvbGRlciksICJhZG5fdHJhc2hfY29kZSIpDQogICAgb3MubWFrZWRpcnModGFyZ2V0X3BhdGgsIGV4aXN0X29rPVRydWUpDQogICAgcHJpbnQoZiJDcmVhdGVkIGZvbGRlcnM6IHttb2R1bGVzX3BhdGh9LCB7dGFyZ2V0X3BhdGh9IikNCiAgICBpbml0aWFsX2ZpbGVzID0gWyJmdW5jdGlvbnMucHkiLCAic3VtbWFyaXphdGlvbi5weSIsICJjb21wcmVzc2lvbi5weSIsICJyZXNvdXJjZXMucHkiLCAiZmlsZV9tYW5hZ2VyLnB5Il0NCiAgICBmb3IgZmlsZSBpbiBpbml0aWFsX2ZpbGVzOg0KICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obW9kdWxlc19wYXRoLCBmaWxlKQ0KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmlsZV9wYXRoKToNCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJ3IikgYXMgZjoNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiIyBQbGFjZWhvbGRlciBmb3Ige2ZpbGV9XG4iKQ0KICAgICAgICAgICAgcHJpbnQoZiJDcmVhdGVkIGZpbGU6IHtmaWxlX3BhdGh9IikNCiAgICBwcmludCgiUHJvamVjdCBzdHJ1Y3R1cmUgc2V0dXAgY29tcGxldGUhIikNCg0KZGVmIG1vZHVsYXJpemVfZnVuY3Rpb25zKG1vZHVsZXNfZm9sZGVyPSJtb2R1bGVzIiwgbWFpbl9zY3JpcHQ9Tm9uZSk6DQogICAgaWYgbWFpbl9zY3JpcHQgaXMgTm9uZToNCiAgICAgICAgbWFpbl9zY3JpcHQgPSBvcy5wYXRoLmFic3BhdGgoX19maWxlX18pDQogICAgaWYgbm90IG9zLnBhdGguaXNkaXIobW9kdWxlc19mb2xkZXIpOg0KICAgICAgICBhbHRlcm5hdGl2ZSA9IG9zLnBhdGguam9pbigiQ29kZUJvdCIsIG1vZHVsZXNfZm9sZGVyKQ0KICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKGFsdGVybmF0aXZlKToNCiAgICAgICAgICAgIG1vZHVsZXNfZm9sZGVyID0gYWx0ZXJuYXRpdmUNCiAgICBtb2R1bGVfbWFwcGluZyA9IHsNCiAgICAgICAgImdlbmVyYXRlX3N5bWJvbF9saWJyYXJ5IjogImZ1bmN0aW9ucy5weSIsDQogICAgICAgICJzdW1tYXJpemVfcnVudGltZSI6ICJzdW1tYXJpemF0aW9uLnB5IiwNCiAgICAgICAgImNvbXByZXNzX2xpYnJhcmllcyI6ICJjb21wcmVzc2lvbi5weSIsDQogICAgICAgICJkZWNvbXByZXNzX2xpYnJhcnkiOiAiY29tcHJlc3Npb24ucHkiLA0KICAgICAgICAibW9uaXRvcl9yZXNvdXJjZXMiOiAicmVzb3VyY2VzLnB5IiwNCiAgICAgICAgInNldHVwX3Byb2plY3Rfc3RydWN0dXJlIjogImZpbGVfbWFuYWdlci5weSINCiAgICB9DQogICAgcHJpbnQoIlxuTW9kdWxhcml6aW5nIGZ1bmN0aW9ucyBmcm9tIHRoZSBtYWluIHNjcmlwdC4uLiIpDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4obWFpbl9zY3JpcHQsICJyIikgYXMgbWFpbl9maWxlOg0KICAgICAgICAgICAgbWFpbl9saW5lcyA9IG1haW5fZmlsZS5yZWFkbGluZXMoKQ0KICAgICAgICBmb3IgZnVuY19uYW1lLCBtb2R1bGVfZmlsZSBpbiBtb2R1bGVfbWFwcGluZy5pdGVtcygpOg0KICAgICAgICAgICAgbW9kdWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obW9kdWxlc19mb2xkZXIsIG1vZHVsZV9maWxlKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobW9kdWxlX3BhdGgpOg0KICAgICAgICAgICAgICAgIHdpdGggb3Blbihtb2R1bGVfcGF0aCwgInIiKSBhcyBtb2R1bGU6DQogICAgICAgICAgICAgICAgICAgIG1vZHVsZV9jb250ZW50ID0gbW9kdWxlLnJlYWQoKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBtb2R1bGVfY29udGVudCA9ICIiDQogICAgICAgICAgICB3aXRoIG9wZW4obW9kdWxlX3BhdGgsICJhIikgYXMgbW9kdWxlOg0KICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIG1haW5fbGluZXM6DQogICAgICAgICAgICAgICAgICAgIGlmIGYiZGVmIHtmdW5jX25hbWV9IiBpbiBsaW5lIGFuZCBmImRlZiB7ZnVuY19uYW1lfSIgbm90IGluIG1vZHVsZV9jb250ZW50Og0KICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLndyaXRlKGxpbmUpDQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIk1vdmVkIHtmdW5jX25hbWV9IHRvIHttb2R1bGVfZmlsZX0iKQ0KICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoNCiAgICAgICAgcHJpbnQoZiJNYWluIHNjcmlwdCAne21haW5fc2NyaXB0fScgbm90IGZvdW5kLiBDYW5ub3QgbW9kdWxhcml6ZSBmdW5jdGlvbnMuIikNCg0KZGVmIGNvbXByZXNzX2FuZF9lbmNvZGVfc2NyaXB0KHNjcmlwdF9wYXRoPU5vbmUsIHppcF9uYW1lPSJjb2RlYm90X2NvcmUuemlwIiwgb3V0cHV0X2ZpbGVfYmFzZT0iY29kZWJvdF9jb3JlX2Jhc2U2NF92b2wiKToNCiAgICBpZiBzY3JpcHRfcGF0aCBpcyBOb25lOg0KICAgICAgICBzY3JpcHRfcGF0aCA9IG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykNCiAgICB6aXBfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCB6aXBfbmFtZSkNCiAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSh6aXBfcGF0aCwgInciKSBhcyB6aXBmOg0KICAgICAgICB6aXBmLndyaXRlKHNjcmlwdF9wYXRoLCBhcmNuYW1lPSJjb2RlYm90X2NvcmUucHkiKQ0KICAgIHByaW50KGYiU2NyaXB0IGNvbXByZXNzZWQgaW50bzoge3ppcF9uYW1lfSIpDQogICAgd2l0aCBvcGVuKHppcF9wYXRoLCAicmIiKSBhcyB6aXBfZmlsZToNCiAgICAgICAgZW5jb2RlZCA9IGJhc2U2NC5iNjRlbmNvZGUoemlwX2ZpbGUucmVhZCgpKS5kZWNvZGUoInV0Zi04IikNCiAgICB2b2x1bWVfZmlsZXMgPSBzcGxpdF9hbmRfc2F2ZV9iYXNlNjQoZW5jb2RlZCwgdm9sdW1lX2Jhc2U9b3V0cHV0X2ZpbGVfYmFzZSwgY2h1bmtfc2l6ZT05OTk5KQ0KICAgIHByaW50KCJCYXNlNjQtZW5jb2RlZCBzY3JpcHQgaGFzIGJlZW4gc3BsaXQgaW50byB2b2x1bWVzLiIpDQogICAgcmV0dXJuIHZvbHVtZV9maWxlcw0KDQpkZWYgc3BsaXRfYW5kX3NhdmVfYmFzZTY0KGVuY29kZWRfdGV4dCwgdm9sdW1lX2Jhc2U9ImNvZGVib3RfY29yZV9iYXNlNjRfdm9sIiwgY2h1bmtfc2l6ZT05OTk5KToNCiAgICB2b2x1bWVzID0gW2VuY29kZWRfdGV4dFtpOmkrY2h1bmtfc2l6ZV0gZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKGVuY29kZWRfdGV4dCksIGNodW5rX3NpemUpXQ0KICAgIHZvbHVtZV9maWxlcyA9IFtdDQogICAgZm9yIGluZGV4LCBjaHVuayBpbiBlbnVtZXJhdGUodm9sdW1lcywgc3RhcnQ9MSk6DQogICAgICAgIGZpbGVuYW1lID0gZiJ7dm9sdW1lX2Jhc2V9e2luZGV4fS50eHQiDQogICAgICAgIG91dHB1dF9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICB3aXRoIG9wZW4ob3V0cHV0X3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoY2h1bmspDQogICAgICAgIHZvbHVtZV9maWxlcy5hcHBlbmQoZmlsZW5hbWUpDQogICAgICAgIHByaW50KGYiU2F2ZWQgVm9sdW1lIHtpbmRleH0gdG8ge2ZpbGVuYW1lfSIpDQogICAgcmV0dXJuIHZvbHVtZV9maWxlcw0KDQpkZWYgc2Nhbl90ZXN0X2ZvbGRlcihmb2xkZXJfcGF0aCk6DQogICAgIiIiDQogICAgU2NhbnMgdGhlIHRlc3QgZm9sZGVyIGZvciBhdmFpbGFibGUgdG9vbHMgYW5kIHJldHVybnMgYSBsaXN0IG9mIGZpbGVzLg0KICAgICIiIg0KICAgIHJldHVybiBbZiBmb3IgZiBpbiBvcy5saXN0ZGlyKGZvbGRlcl9wYXRoKSBpZiBvcy5wYXRoLmlzZmlsZShvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsIGYpKV0NCg0KZGVmIHdvcmRfcmVjb2duaXRpb24oaW5wdXRfdGV4dCwgZGljdGlvbmFyeV9wYXRoPSJDOlxcZGV2XFxhZG5fdHJhc2hfY29kZVxcZGljdGlvbmFyaWVzXFxlbmdsaXNoX3dvcmRzLnR4dCIpOg0KICAgICIiIg0KICAgIENoZWNrcyBpZiB0aGUgaW5wdXQgY29udGFpbnMgdmFsaWQgRW5nbGlzaCB3b3JkcyBmcm9tIHRoZSBkaWN0aW9uYXJ5Lg0KICAgICIiIg0KICAgIHdpdGggb3BlbihkaWN0aW9uYXJ5X3BhdGgsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgd29yZF9saXN0ID0gc2V0KGYucmVhZCgpLnNwbGl0bGluZXMoKSkNCiAgICANCiAgICBpbnB1dF93b3JkcyA9IHNldChpbnB1dF90ZXh0Lmxvd2VyKCkuc3BsaXQoKSkNCiAgICByZWNvZ25pemVkX3dvcmRzID0gaW5wdXRfd29yZHMuaW50ZXJzZWN0aW9uKHdvcmRfbGlzdCkNCiAgICANCiAgICByZXR1cm4gcmVjb2duaXplZF93b3Jkcw0KDQpkZWYgc3VnZ2VzdF93b3JkKGlucHV0X3dvcmQsIGRpY3Rpb25hcnlfcGF0aD0iQzpcXGRldlxcYWRuX3RyYXNoX2NvZGVcXGRpY3Rpb25hcmllc1xcZW5nbGlzaF93b3Jkcy50eHQiKToNCiAgICAiIiINCiAgICBTdWdnZXN0cyB3b3JkcyBmcm9tIHRoZSBkaWN0aW9uYXJ5IHRoYXQgc3RhcnQgd2l0aCB0aGUgc2FtZSBsZXR0ZXJzIGFzIHRoZSBpbnB1dCB3b3JkLg0KICAgICIiIg0KICAgIHdpdGggb3BlbihkaWN0aW9uYXJ5X3BhdGgsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgd29yZF9saXN0ID0gW3dvcmQuc3RyaXAoKSBmb3Igd29yZCBpbiBmLnJlYWRsaW5lcygpXQ0KDQogICAgc3VnZ2VzdGlvbnMgPSBbd29yZCBmb3Igd29yZCBpbiB3b3JkX2xpc3QgaWYgd29yZC5zdGFydHN3aXRoKGlucHV0X3dvcmQubG93ZXIoKSldDQogICAgcmV0dXJuIHN1Z2dlc3Rpb25zWzo1XSAgIyBSZXR1cm4gdXAgdG8gNSBzdWdnZXN0aW9ucw0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBNQUlOIEVYRUNVVElPTg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgcHJpbnQoIlxuU3RlcCAxOiBTZXR0aW5nIHVwIHByb2plY3Qgc3RydWN0dXJlLi4uIikNCiAgICBzZXR1cF9wcm9qZWN0X3N0cnVjdHVyZSgpDQoNCiAgICBwcmludCgiXG5TdGVwIDI6IE1vZHVsYXJpemluZyBmdW5jdGlvbnMuLi4iKQ0KICAgIG1vZHVsYXJpemVfZnVuY3Rpb25zKCkNCg0KICAgIHJlc291cmNlX21vbml0b3JfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9bW9uaXRvcl9yZXNvdXJjZXMsIGRhZW1vbj1UcnVlKQ0KICAgIHJlc291cmNlX21vbml0b3JfdGhyZWFkLnN0YXJ0KCkNCg0KICAgIHByaW50KCJcblN0ZXAgMzogTGF1bmNoaW5nIFVJIEludGVyZmFjZS4uLiIpDQogICAgbGF1bmNoX3VpKCkNCg0KICAgIHByaW50KCJcblN0ZXAgNDogQ3JlYXRpbmcga25vd2xlZGdlIGFyY2hpdmUuLi4iKQ0KICAgIGNyZWF0ZV9rbm93bGVkZ2VfYXJjaGl2ZSgiLi4vYWRuX3RyYXNoX2NvZGUiKQ0KDQogICAgcHJpbnQoIlxuU3RlcCA1OiBDb21wcmVzc2luZyBsaWJyYXJpZXMuLi4iKQ0KICAgIGNvbXByZXNzX2xpYnJhcmllcygpDQoNCiAgICBwcmludCgiXG5TdGVwIDY6IEVuY29kaW5nIG1haW4gc2NyaXB0IHRvIEJhc2U2NCBhbmQgc3BsaXR0aW5nIGludG8gdm9sdW1lcy4uLiIpDQogICAgdm9sdW1lc19jcmVhdGVkID0gY29tcHJlc3NfYW5kX2VuY29kZV9zY3JpcHQoKQ0KICAgIHByaW50KCJWb2x1bWVzIGNyZWF0ZWQ6Iiwgdm9sdW1lc19jcmVhdGVkKQ0KDQogICAgcHJpbnQoIlxuU3RlcCA3OiBUZXN0aW5nIGRlY29tcHJlc3Npb24gb2YgcnVudGltZSBsaWJyYXJ5Li4uIikNCiAgICBkZWNvbXByZXNzX2xpYnJhcnkoZmlsZV90b19leHRyYWN0PSJydW50aW1lX2xpYnJhcnkudHh0IikNCg0KICAgIHByaW50KCJcblN0ZXAgODogU2NhbiB0ZXN0IGZvbGRlci4uLiIpDQogICAgdGVzdF90b29scyA9IHNjYW5fdGVzdF9mb2xkZXIoIkM6XFxkZXZcXHRlc3QiKQ0KICAgIHByaW50KGYiQXZhaWxhYmxlIHRvb2xzIGluIHRoZSB0ZXN0IGZvbGRlcjoge3Rlc3RfdG9vbHN9IikNCiAgICANCiAgICBwcmludCgiXG5TdGVwIDk6IEdlbmVyYXRpbmcgc3ltYm9sIGxpYnJhcnkuLi4iKQ0KICAgIHNhdmVfd29yZGxpc3RzKCJDOlxcZGV2XFxhZG5fdHJhc2hfY29kZVxcZGljdGlvbmFyaWVzIikNCg0KICAgIHByaW50KCJcblN0ZXAgMTA6IFRlYWNoaW5nIENvZGVCb3QgUHl0aG9uLi4uIikNCiAgICBweXRob25fbGlicyA9IGxvYWRfcHl0aG9uX2xpYnJhcnkoKQ0KICAgIGZvciBsaWIgaW4gcHl0aG9uX2xpYnM6DQogICAgICAgIGFuYWx5emVfbGlicmFyeShvcy5wYXRoLmpvaW4oIkM6XFxkZXZcXGFkbl90cmFzaF9jb2RlXFxweXRob25fbGlicyIsIGxpYikpDQoNCiAgICBwcmludCgiXG5TdGVwIDExOiBDcmVhdGluZyBwYXJhbGxlbCB0ZXN0aW5nIGVudmlyb25tZW50Li4uIikNCiAgICBjb3B5X2NvcmVfZm9yX3Rlc3RpbmcoKQ0KDQogICAgcHJpbnQoIlxuQWxsIHRhc2tzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuIikNCg0KIyBDb2RlQm90X1RyYWNraW5nDQpQSwECFAAUAAAAAAB5qXdaN0+BgPI5AADyOQAADwAAAAAAAAAAAAAAtoEAAAAAY29kZWJvdF9jb3JlLnB5UEsFBgAAAAABAAEAPQAAAB86AAAAAA==