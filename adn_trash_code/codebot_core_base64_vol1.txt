UEsDBBQAAAAAAPqeeFphsjHaXTwAAF08AAAPAAAAY29kZWJvdF9jb3JlLnB5I0tFWVdPUkQ6IENvZGVCb3RfVHJhY2tpbmcNCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQpzeXMucGF0aC5hcHBlbmQoIkM6XFxkZXZcXENvZGVCb3QiKQ0KaW1wb3J0IHRocmVhZGluZw0KaW1wb3J0IHRpbWUNCmltcG9ydCBiYXNlNjQNCmltcG9ydCB6aXBmaWxlDQppbXBvcnQga2V5Ym9hcmQgICMgcGlwIGluc3RhbGwga2V5Ym9hcmQNCg0KIyAtLS0gR2xvYmFsIFBhdGhzIC0tLQ0KQ09ERUJPVF9ESVIgPSBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkNCkFEQl9ESVIgPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5kaXJuYW1lKENPREVCT1RfRElSKSwgImFkbl90cmFzaF9jb2RlIikNCm9zLm1ha2VkaXJzKEFEQl9ESVIsIGV4aXN0X29rPVRydWUpDQoNCk1PRFVMRVNfRElSID0gb3MucGF0aC5qb2luKENPREVCT1RfRElSLCAibW9kdWxlcyIpDQppZiBNT0RVTEVTX0RJUiBub3QgaW4gc3lzLnBhdGg6DQogICAgc3lzLnBhdGguYXBwZW5kKE1PRFVMRVNfRElSKQ0KDQojIC0tLSBJbXBvcnQgZnJvbSBtb2R1bGVzIC0tLQ0KZnJvbSBtb2R1bGVzLmZpbGVfbWFuYWdlciBpbXBvcnQgc2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUsIHNjYW5fdGVzdF9mb2xkZXINCmZyb20gbW9kdWxlcy5jb21wcmVzc2lvbiBpbXBvcnQgY29tcHJlc3NfbGlicmFyaWVzLCBkZWNvbXByZXNzX2xpYnJhcnkNCmZyb20gbW9kdWxlcy5rbm93bGVkZ2VfYmFzZSBpbXBvcnQgY3JlYXRlX2tub3dsZWRnZV9hcmNoaXZlDQpmcm9tIG1vZHVsZXMudWlfaW50ZXJmYWNlIGltcG9ydCBsYXVuY2hfdWksIGhhbmRsZV9pbnB1dA0KZnJvbSBtb2R1bGVzLmRpY3Rpb25hcmllcyBpbXBvcnQgc2F2ZV93b3JkbGlzdHMNCmZyb20gbW9kdWxlcy5zdW1tYXJpemF0aW9uIGltcG9ydCBzdW1tYXJpemVfcnVudGltZQ0KZnJvbSBtb2R1bGVzLnJlc291cmNlcyBpbXBvcnQgbW9uaXRvcl9yZXNvdXJjZXMNCmZyb20gbW9kdWxlcy5mdW5jdGlvbnMgaW1wb3J0IGdlbmVyYXRlX3N5bWJvbF9saWJyYXJ5DQpmcm9tIG1vZHVsZXMubGVhcm5pbmcgaW1wb3J0IGxvYWRfcHl0aG9uX2xpYnJhcnkNCmZyb20gbW9kdWxlcy5sZWFybmluZyBpbXBvcnQgYW5hbHl6ZV9saWJyYXJ5DQpmcm9tIG1vZHVsZXMubGVhcm5pbmcgaW1wb3J0IGxvYWRfbGFuZ3VhZ2VfbGlicmFyaWVzDQpmcm9tIG1vZHVsZXMubGVhcm5pbmcgaW1wb3J0IGNvcHlfY29yZV9mb3JfdGVzdGluZw0KZnJvbSBtb2R1bGVzLmFpX2VuZ2luZSBpbXBvcnQgZXhwbGFpbl9weXRob25fY29kZQ0KDQoNCiMgLS0tIEdsb2JhbCBWYXJpYWJsZXMgLS0tDQpjb252ZXJzYXRpb25fdGV4dCA9ICIiIg0KICAgIEZ1bGwgQ29waWxvdCBjb252ZXJzYXRpb24gY29waWVkIGZyb20gRWRnZSBicm93c2VyLg0KICAgIFBhc3RlIGV2ZXJ5dGhpbmcgaGVyZSB3aXRoaW4gdHJpcGxlIHF1b3Rlcy4NCiAgICAiIiINCmZyb20gbW9kdWxlcy5rbm93bGVkZ2VfYmFzZSBpbXBvcnQgZXhwb3J0X2NvbnZlcnNhdGlvbl9sb2cNCmV4cG9ydF9jb252ZXJzYXRpb25fbG9nKGNvbnZlcnNhdGlvbl90ZXh0KQ0KDQoNCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQojIENPUkUgRlVOQ1RJT05TIChwcm9jZXNzaW5nIGZ1bmN0aW9ucykNCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQpkZWYgZW5jb2RlX2luc3RydWN0aW9uKGluc3RydWN0aW9uKToNCiAgICBjb21wcmVzc2VkID0gaW5zdHJ1Y3Rpb24uZW5jb2RlKCJ1dGYtOCIpDQogICAgcmV0dXJuIGJhc2U2NC5iNjRlbmNvZGUoY29tcHJlc3NlZCkuZGVjb2RlKCJ1dGYtOCIpDQoNCmRlZiBkZWNvZGVfaW5zdHJ1Y3Rpb24oZW5jb2RlZCk6DQogICAgY29tcHJlc3NlZCA9IGJhc2U2NC5iNjRkZWNvZGUoZW5jb2RlZCkuZGVjb2RlKCJ1dGYtOCIpDQogICAgcmV0dXJuIGNvbXByZXNzZWQucmVwbGFjZSgiKCIsICIgIikucmVwbGFjZSgiKSIsICIgIikucmVwbGFjZSgifCIsICIgfCAiKQ0KDQpkZWYgZ2VuZXJhdGVfY29kZShpbnN0cnVjdGlvbik6DQogICAgcGFydHMgPSBpbnN0cnVjdGlvbi5zcGxpdCgifCIpDQogICAgaWYgbGVuKHBhcnRzKSAhPSAzOg0KICAgICAgICByZXR1cm4gZiIjIEludmFsaWQgaW5zdHJ1Y3Rpb24gZm9ybWF0OiB7aW5zdHJ1Y3Rpb259Ig0KICAgIGZ1bmNfbmFtZSA9IHBhcnRzWzFdLnN0cmlwKCkNCiAgICBwYXJhbXMgPSBwYXJ0c1syXS5zdHJpcCgpDQogICAgcGFyYW1zX3dpdGhfc3BhY2VzID0gIiwgIi5qb2luKHBhcmFtLnN0cmlwKCkgZm9yIHBhcmFtIGluIHBhcmFtcy5zcGxpdCgiLCIpKQ0KICAgIGZvcm1hdHRlZF9yZXR1cm4gPSAiICsgIi5qb2luKHBhcmFtLnN0cmlwKCkgZm9yIHBhcmFtIGluIHBhcmFtcy5zcGxpdCgiLCIpKQ0KICAgIHJldHVybiAoZiJkZWYge2Z1bmNfbmFtZX0oe3BhcmFtc193aXRoX3NwYWNlc30pOlxuIg0KICAgICAgICAgICAgZiIgICAgcmV0dXJuIHtmb3JtYXR0ZWRfcmV0dXJufVxuIikNCg0KZGVmIHNhdmVfY29kZV90b19maWxlKGNvZGUsIGZpbGVuYW1lPSJkeW5hbWljX2FyY2hpdmUucHkiKToNCiAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgImEiKSBhcyBmaWxlOg0KICAgICAgICBmaWxlLndyaXRlKGNvZGUgKyAiXG5cbiIpDQogICAgcHJpbnQoZiJDb2RlIGFyY2hpdmVkIGF0OiB7ZmlsZV9wYXRofSIpDQoNCmRlZiBsb2FkX2FyY2hpdmVkX2NvZGUoZmlsZW5hbWU9ImR5bmFtaWNfYXJjaGl2ZS5weSIpOg0KICAgIHRyeToNCiAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiciIpIGFzIGZpbGU6DQogICAgICAgICAgICBhcmNoaXZlZF9jb2RlID0gZmlsZS5yZWFkbGluZXMoKQ0KICAgICAgICBwcmludChmIkxvYWRlZCB7bGVuKGFyY2hpdmVkX2NvZGUpfSBsaW5lcyBvZiBhcmNoaXZlZCBjb2RlLiIpDQogICAgICAgIHJldHVybiBhcmNoaXZlZF9jb2RlDQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOg0KICAgICAgICBwcmludCgiTm8gYXJjaGl2ZWQgY29kZSBmb3VuZC4gU3RhcnRpbmcgZnJlc2guIikNCiAgICAgICAgcmV0dXJuIFtdDQoNCmRlZiByZWZpbmVfY29kZShnZW5lcmF0ZWRfY29kZSwgYXJjaGl2ZWRfY29kZSk6DQogICAgcmVmaW5lZF9jb2RlID0gZ2VuZXJhdGVkX2NvZGUuc3BsaXQoIlxuIikNCiAgICByZWZpbmVkX2xpbmVzID0gW10NCiAgICBmb3IgbGluZSBpbiByZWZpbmVkX2NvZGU6DQogICAgICAgIGlzX3JlZmluZWQgPSBhbnkoIiMgUmVmaW5lZCBmcm9tIGFyY2hpdmUiIGluIGwgZm9yIGwgaW4gcmVmaW5lZF9saW5lcykNCiAgICAgICAgaWYgbGluZS5zdHJpcCgpIGluIGFyY2hpdmVkX2NvZGUgYW5kIG5vdCBpc19yZWZpbmVkOg0KICAgICAgICAgICAgcmVmaW5lZF9saW5lcy5hcHBlbmQoZiJ7bGluZS5zdHJpcCgpfSAgIyBSZWZpbmVkIGZyb20gYXJjaGl2ZSIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZWZpbmVkX2xpbmVzLmFwcGVuZChsaW5lLnN0cmlwKCkpDQogICAgcmV0dXJuICJcbiIuam9pbihyZWZpbmVkX2xpbmVzKQ0KDQpkZWYgc3BsaXRfYW5kX3NhdmVfYmFzZTY0KGVuY29kZWRfdGV4dCwgdm9sdW1lX2Jhc2U9ImNvZGVib3RfY29yZV9iYXNlNjRfdm9sIiwgY2h1bmtfc2l6ZT05OTk5KToNCiAgICB2b2x1bWVzID0gW2VuY29kZWRfdGV4dFtpOmkrY2h1bmtfc2l6ZV0gZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKGVuY29kZWRfdGV4dCksIGNodW5rX3NpemUpXQ0KICAgIHZvbHVtZV9maWxlcyA9IFtdDQogICAgZm9yIGluZGV4LCBjaHVuayBpbiBlbnVtZXJhdGUodm9sdW1lcywgc3RhcnQ9MSk6DQogICAgICAgIGZpbGVuYW1lID0gZiJ7dm9sdW1lX2Jhc2V9e2luZGV4fS50eHQiDQogICAgICAgIG91dHB1dF9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICB3aXRoIG9wZW4ob3V0cHV0X3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoY2h1bmspDQogICAgICAgIHZvbHVtZV9maWxlcy5hcHBlbmQoZmlsZW5hbWUpDQogICAgICAgIHByaW50KGYiU2F2ZWQgVm9sdW1lIHtpbmRleH0gdG8ge2ZpbGVuYW1lfSIpDQogICAgcmV0dXJuIHZvbHVtZV9maWxlcw0KDQpkZWYgY29tcHJlc3NfYW5kX2VuY29kZV9zY3JpcHQoc2NyaXB0X3BhdGg9Tm9uZSwgemlwX25hbWU9ImNvZGVib3RfY29yZS56aXAiLCBvdXRwdXRfZmlsZV9iYXNlPSJjb2RlYm90X2NvcmVfYmFzZTY0X3ZvbCIpOg0KICAgIGlmIHNjcmlwdF9wYXRoIGlzIE5vbmU6DQogICAgICAgIHNjcmlwdF9wYXRoID0gb3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKQ0KICAgIHppcF9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIHppcF9uYW1lKQ0KICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKHppcF9wYXRoLCAidyIpIGFzIHppcGY6DQogICAgICAgIHppcGYud3JpdGUoc2NyaXB0X3BhdGgsIGFyY25hbWU9ImNvZGVib3RfY29yZS5weSIpDQogICAgcHJpbnQoZiJTY3JpcHQgY29tcHJlc3NlZCBpbnRvOiB7emlwX25hbWV9IikNCiAgICB3aXRoIG9wZW4oemlwX3BhdGgsICJyYiIpIGFzIHppcF9maWxlOg0KICAgICAgICBlbmNvZGVkID0gYmFzZTY0LmI2NGVuY29kZSh6aXBfZmlsZS5yZWFkKCkpLmRlY29kZSgidXRmLTgiKQ0KICAgIHZvbHVtZV9maWxlcyA9IHNwbGl0X2FuZF9zYXZlX2Jhc2U2NChlbmNvZGVkLCB2b2x1bWVfYmFzZT1vdXRwdXRfZmlsZV9iYXNlLCBjaHVua19zaXplPTk5OTkpDQogICAgcHJpbnQoIkJhc2U2NC1lbmNvZGVkIHNjcmlwdCBoYXMgYmVlbiBzcGxpdCBpbnRvIHZvbHVtZXMuIikNCiAgICByZXR1cm4gdm9sdW1lX2ZpbGVzDQoNCmRlZiBwcm9jZXNzX3JlcXVlc3QoZW5jb2RlZF9yZXF1ZXN0KToNCiAgICBpbnN0cnVjdGlvbiA9IGRlY29kZV9pbnN0cnVjdGlvbihlbmNvZGVkX3JlcXVlc3QpDQogICAgcHJpbnQoZiJSZWNlaXZlZCBJbnN0cnVjdGlvbjoge2luc3RydWN0aW9ufSIpDQogICAgZ2VuZXJhdGVkX2NvZGUgPSBnZW5lcmF0ZV9jb2RlKGluc3RydWN0aW9uKQ0KICAgIGFyY2hpdmVkX2NvZGUgPSBsb2FkX2FyY2hpdmVkX2NvZGUoKQ0KICAgIHJlZmluZWRfY29kZSA9IHJlZmluZV9jb2RlKGdlbmVyYXRlZF9jb2RlLCBhcmNoaXZlZF9jb2RlKQ0KICAgIHNhdmVfY29kZV90b19maWxlKHJlZmluZWRfY29kZSkNCiAgICBkZWJ1Z19maWxlID0gb3MucGF0aC5qb2luKEFEQl9ESVIsICJkZWJ1Z19yZXN1bHRzLnR4dCIpDQogICAgb3MubWFrZWRpcnMoQURCX0RJUiwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICB3aXRoIG9wZW4oZGVidWdfZmlsZSwgImEiKSBhcyBkZWJ1Z19yZXN1bHRzOg0KICAgICAgICBkZWJ1Z19yZXN1bHRzLndyaXRlKGYiUmVjZWl2ZWQgSW5zdHJ1Y3Rpb246IHtpbnN0cnVjdGlvbn1cbiIpDQogICAgICAgIGRlYnVnX3Jlc3VsdHMud3JpdGUoZiJHZW5lcmF0ZWQgQ29kZTpcbntnZW5lcmF0ZWRfY29kZX1cbiIpDQogICAgICAgIGRlYnVnX3Jlc3VsdHMud3JpdGUoZiJSZWZpbmVkIENvZGU6XG57cmVmaW5lZF9jb2RlfVxuXG4iKQ0KICAgIGNvbXByZXNzZWRfcmVzcG9uc2UgPSBlbmNvZGVfaW5zdHJ1Y3Rpb24ocmVmaW5lZF9jb2RlKQ0KICAgIGRlY29kZWRfcmVzcG9uc2UgPSBkZWNvZGVfaW5zdHJ1Y3Rpb24oY29tcHJlc3NlZF9yZXNwb25zZSkucmVwbGFjZSgiIDoiLCAiOiIpDQogICAgcmV0dXJuIGNvbXByZXNzZWRfcmVzcG9uc2UsIGRlY29kZWRfcmVzcG9uc2UNCg0KZGVmIG51bWJlcl9jb3VudGVyKGZpbGVuYW1lPSJudW1iZXJfZGF0YWJhc2UudHh0IiwgbWF4X2l0ZXJhdGlvbnM9MTAwMCk6DQogICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgIGxhc3RfbnVtYmVyID0gMA0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInIiKSBhcyBmaWxlOg0KICAgICAgICAgICAgbGluZXMgPSBmaWxlLnJlYWRsaW5lcygpDQogICAgICAgICAgICBpZiBsaW5lczoNCiAgICAgICAgICAgICAgICBsYXN0X251bWJlciA9IGludChsaW5lc1stMV0uc3RyaXAoKSkNCiAgICAgICAgICAgIHByaW50KGYiUmVzdW1pbmcgZnJvbSBsYXN0IG51bWJlcjoge2xhc3RfbnVtYmVyfSIpDQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOg0KICAgICAgICBwcmludChmIk5vIGRhdGFiYXNlIGZvdW5kLiBTdGFydGluZyBmcmVzaCBmcm9tIHtsYXN0X251bWJlcn0uIikNCiAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiYSIpIGFzIGZpbGU6DQogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIG1heF9pdGVyYXRpb25zICsgMSk6DQogICAgICAgICAgICBjdXJyZW50X251bWJlciA9IGxhc3RfbnVtYmVyICsgaQ0KICAgICAgICAgICAgZmlsZS53cml0ZShmIntjdXJyZW50X251bWJlcn1cbiIpDQogICAgICAgIHByaW50KGYiQ291bnRlZCBhbmQgc2F2ZWQgbnVtYmVycyB1cCB0byB7bGFzdF9udW1iZXIgKyBtYXhfaXRlcmF0aW9uc30uIikNCg0KZGVmIHJ1bnRpbWVfZXhlY3V0aW9uKCk6DQogICAgIiIiDQogICAgQ29kZUJvdCB3YWl0cyBmb3IgdXNlciBpbnB1dCwgcmVzcG9uZHMgdG8gZ3JlZXRpbmdzLCByZWNvZ25pemVzIHdvcmRzIGZyb20gYSBkaWN0aW9uYXJ5LA0KICAgIHN1Z2dlc3RzIHNpbWlsYXIgd29yZHMsIGFuZCBleGl0cyBhZnRlciA2MCBzZWNvbmRzIG9mIGluYWN0aXZpdHkgb3Igd2hlbiAncXVpdCcgaXMgdHlwZWQuDQogICAgSW5jbHVkZXMgYSBzdGFuZGJ5IGRlbGF5IGFmdGVyIGVhY2ggaW50ZXJhY3Rpb24gdG8gcmVkdWNlIHJlc291cmNlIHVzYWdlLg0KICAgICIiIg0KICAgIGltcG9ydCB0aW1lDQoNCiAgICBwcmludCgiQ29kZUJvdCBpcyByZWFkeSBhbmQgd2FpdGluZyBmb3IgeW91ciBpbnB1dC4gVHlwZSAncXVpdCcgdG8gZXhpdCwgb3IgZ3JlZXQgbWUhIikNCiAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkgICMgVHJhY2sgdGhlIHRpbWUgd2hlbiB0aGUgbG9vcCBiZWdpbnMNCg0KICAgIHdoaWxlIFRydWU6DQogICAgICAgICMgQ2FsY3VsYXRlIGVsYXBzZWQgdGltZQ0KICAgICAgICBlbGFwc2VkX3RpbWUgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUNCiAgICAgICAgaWYgZWxhcHNlZF90aW1lID4gNjA6ICAjIEV4aXQgaWYgdGhlcmUncyBubyBpbnRlcmFjdGlvbiBmb3IgNjAgc2Vjb25kcw0KICAgICAgICAgICAgcHJpbnQoIkNvZGVCb3Q6IE5vIGludGVyYWN0aW9uIGRldGVjdGVkLiBHb29kYnllISIpDQogICAgICAgICAgICBicmVhaw0KDQogICAgICAgICMgR2V0IHVzZXIgaW5wdXQNCiAgICAgICAgdXNlcl9pbnB1dCA9IGlucHV0KCJZb3U6ICIpLnN0cmlwKCkubG93ZXIoKQ0KDQogICAgICAgICMgSGFuZGxlIHVzZXIgaW5wdXQNCiAgICAgICAgaWYgdXNlcl9pbnB1dCBpbiBbImhlbGxvIiwgImhpIiwgImhleSIsICJncmVldGluZ3MiXToNCiAgICAgICAgICAgIHByaW50KCJDb2R