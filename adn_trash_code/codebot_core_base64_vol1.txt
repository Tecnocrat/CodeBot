UEsDBBQAAAAAAMpDeFoutI55HDoAABw6AAAPAAAAY29kZWJvdF9jb3JlLnB5I0tFWVdPUkQ6IENvZGVCb3RfVHJhY2tpbmcNCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQpzeXMucGF0aC5hcHBlbmQoIkM6XFxkZXZcXENvZGVCb3QiKQ0KaW1wb3J0IHRocmVhZGluZw0KaW1wb3J0IHRpbWUNCmltcG9ydCBiYXNlNjQNCmltcG9ydCB6aXBmaWxlDQppbXBvcnQga2V5Ym9hcmQgICMgcGlwIGluc3RhbGwga2V5Ym9hcmQNCg0KIyAtLS0gR2xvYmFsIFBhdGhzIC0tLQ0KQ09ERUJPVF9ESVIgPSBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkNCkFEQl9ESVIgPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5kaXJuYW1lKENPREVCT1RfRElSKSwgImFkbl90cmFzaF9jb2RlIikNCm9zLm1ha2VkaXJzKEFEQl9ESVIsIGV4aXN0X29rPVRydWUpDQoNCk1PRFVMRVNfRElSID0gb3MucGF0aC5qb2luKENPREVCT1RfRElSLCAibW9kdWxlcyIpDQppZiBNT0RVTEVTX0RJUiBub3QgaW4gc3lzLnBhdGg6DQogICAgc3lzLnBhdGguYXBwZW5kKE1PRFVMRVNfRElSKQ0KDQojIC0tLSBJbXBvcnQgZnJvbSBtb2R1bGVzIC0tLQ0KZnJvbSBtb2R1bGVzLmZpbGVfbWFuYWdlciBpbXBvcnQgc2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUsIHNjYW5fdGVzdF9mb2xkZXINCmZyb20gbW9kdWxlcy5jb21wcmVzc2lvbiBpbXBvcnQgY29tcHJlc3NfbGlicmFyaWVzLCBkZWNvbXByZXNzX2xpYnJhcnkNCmZyb20gbW9kdWxlcy5rbm93bGVkZ2VfYmFzZSBpbXBvcnQgY3JlYXRlX2tub3dsZWRnZV9hcmNoaXZlDQpmcm9tIG1vZHVsZXMudWlfaW50ZXJmYWNlIGltcG9ydCBsYXVuY2hfdWksIGhhbmRsZV9pbnB1dA0KZnJvbSBtb2R1bGVzLmRpY3Rpb25hcmllcyBpbXBvcnQgc2F2ZV93b3JkbGlzdHMNCmZyb20gbW9kdWxlcy5zdW1tYXJpemF0aW9uIGltcG9ydCBzdW1tYXJpemVfcnVudGltZQ0KZnJvbSBtb2R1bGVzLnJlc291cmNlcyBpbXBvcnQgbW9uaXRvcl9yZXNvdXJjZXMNCmZyb20gbW9kdWxlcy5mdW5jdGlvbnMgaW1wb3J0IGdlbmVyYXRlX3N5bWJvbF9saWJyYXJ5DQpmcm9tIG1vZHVsZXMubGVhcm5pbmcgaW1wb3J0IGxvYWRfcHl0aG9uX2xpYnJhcnkNCmZyb20gbW9kdWxlcy5sZWFybmluZyBpbXBvcnQgYW5hbHl6ZV9saWJyYXJ5DQpmcm9tIG1vZHVsZXMubGVhcm5pbmcgaW1wb3J0IGNvcHlfY29yZV9mb3JfdGVzdGluZw0KDQojIC0tLSBHbG9iYWwgVmFyaWFibGVzIC0tLQ0KY29udmVyc2F0aW9uX3RleHQgPSAiIiINCiAgICBGdWxsIENvcGlsb3QgY29udmVyc2F0aW9uIGNvcGllZCBmcm9tIEVkZ2UgYnJvd3Nlci4NCiAgICBQYXN0ZSBldmVyeXRoaW5nIGhlcmUgd2l0aGluIHRyaXBsZSBxdW90ZXMuDQogICAgIiIiDQpmcm9tIG1vZHVsZXMua25vd2xlZGdlX2Jhc2UgaW1wb3J0IGV4cG9ydF9jb252ZXJzYXRpb25fbG9nDQpleHBvcnRfY29udmVyc2F0aW9uX2xvZyhjb252ZXJzYXRpb25fdGV4dCkNCg0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBDT1JFIEZVTkNUSU9OUyAocHJvY2Vzc2luZyBmdW5jdGlvbnMpDQojIC0tLS0tLS0tLS0tLS0tLS0tLQ0KZGVmIGVuY29kZV9pbnN0cnVjdGlvbihpbnN0cnVjdGlvbik6DQogICAgY29tcHJlc3NlZCA9IGluc3RydWN0aW9uLmVuY29kZSgidXRmLTgiKQ0KICAgIHJldHVybiBiYXNlNjQuYjY0ZW5jb2RlKGNvbXByZXNzZWQpLmRlY29kZSgidXRmLTgiKQ0KDQpkZWYgZGVjb2RlX2luc3RydWN0aW9uKGVuY29kZWQpOg0KICAgIGNvbXByZXNzZWQgPSBiYXNlNjQuYjY0ZGVjb2RlKGVuY29kZWQpLmRlY29kZSgidXRmLTgiKQ0KICAgIHJldHVybiBjb21wcmVzc2VkLnJlcGxhY2UoIigiLCAiICIpLnJlcGxhY2UoIikiLCAiICIpLnJlcGxhY2UoInwiLCAiIHwgIikNCg0KZGVmIGdlbmVyYXRlX2NvZGUoaW5zdHJ1Y3Rpb24pOg0KICAgIHBhcnRzID0gaW5zdHJ1Y3Rpb24uc3BsaXQoInwiKQ0KICAgIGlmIGxlbihwYXJ0cykgIT0gMzoNCiAgICAgICAgcmV0dXJuIGYiIyBJbnZhbGlkIGluc3RydWN0aW9uIGZvcm1hdDoge2luc3RydWN0aW9ufSINCiAgICBmdW5jX25hbWUgPSBwYXJ0c1sxXS5zdHJpcCgpDQogICAgcGFyYW1zID0gcGFydHNbMl0uc3RyaXAoKQ0KICAgIHBhcmFtc193aXRoX3NwYWNlcyA9ICIsICIuam9pbihwYXJhbS5zdHJpcCgpIGZvciBwYXJhbSBpbiBwYXJhbXMuc3BsaXQoIiwiKSkNCiAgICBmb3JtYXR0ZWRfcmV0dXJuID0gIiArICIuam9pbihwYXJhbS5zdHJpcCgpIGZvciBwYXJhbSBpbiBwYXJhbXMuc3BsaXQoIiwiKSkNCiAgICByZXR1cm4gKGYiZGVmIHtmdW5jX25hbWV9KHtwYXJhbXNfd2l0aF9zcGFjZXN9KTpcbiINCiAgICAgICAgICAgIGYiICAgIHJldHVybiB7Zm9ybWF0dGVkX3JldHVybn1cbiIpDQoNCmRlZiBzYXZlX2NvZGVfdG9fZmlsZShjb2RlLCBmaWxlbmFtZT0iZHluYW1pY19hcmNoaXZlLnB5Iik6DQogICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJhIikgYXMgZmlsZToNCiAgICAgICAgZmlsZS53cml0ZShjb2RlICsgIlxuXG4iKQ0KICAgIHByaW50KGYiQ29kZSBhcmNoaXZlZCBhdDoge2ZpbGVfcGF0aH0iKQ0KDQpkZWYgbG9hZF9hcmNoaXZlZF9jb2RlKGZpbGVuYW1lPSJkeW5hbWljX2FyY2hpdmUucHkiKToNCiAgICB0cnk6DQogICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCBmaWxlbmFtZSkNCiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInIiKSBhcyBmaWxlOg0KICAgICAgICAgICAgYXJjaGl2ZWRfY29kZSA9IGZpbGUucmVhZGxpbmVzKCkNCiAgICAgICAgcHJpbnQoZiJMb2FkZWQge2xlbihhcmNoaXZlZF9jb2RlKX0gbGluZXMgb2YgYXJjaGl2ZWQgY29kZS4iKQ0KICAgICAgICByZXR1cm4gYXJjaGl2ZWRfY29kZQ0KICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoNCiAgICAgICAgcHJpbnQoIk5vIGFyY2hpdmVkIGNvZGUgZm91bmQuIFN0YXJ0aW5nIGZyZXNoLiIpDQogICAgICAgIHJldHVybiBbXQ0KDQpkZWYgcmVmaW5lX2NvZGUoZ2VuZXJhdGVkX2NvZGUsIGFyY2hpdmVkX2NvZGUpOg0KICAgIHJlZmluZWRfY29kZSA9IGdlbmVyYXRlZF9jb2RlLnNwbGl0KCJcbiIpDQogICAgcmVmaW5lZF9saW5lcyA9IFtdDQogICAgZm9yIGxpbmUgaW4gcmVmaW5lZF9jb2RlOg0KICAgICAgICBpc19yZWZpbmVkID0gYW55KCIjIFJlZmluZWQgZnJvbSBhcmNoaXZlIiBpbiBsIGZvciBsIGluIHJlZmluZWRfbGluZXMpDQogICAgICAgIGlmIGxpbmUuc3RyaXAoKSBpbiBhcmNoaXZlZF9jb2RlIGFuZCBub3QgaXNfcmVmaW5lZDoNCiAgICAgICAgICAgIHJlZmluZWRfbGluZXMuYXBwZW5kKGYie2xpbmUuc3RyaXAoKX0gICMgUmVmaW5lZCBmcm9tIGFyY2hpdmUiKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmVmaW5lZF9saW5lcy5hcHBlbmQobGluZS5zdHJpcCgpKQ0KICAgIHJldHVybiAiXG4iLmpvaW4ocmVmaW5lZF9saW5lcykNCg0KZGVmIHNwbGl0X2FuZF9zYXZlX2Jhc2U2NChlbmNvZGVkX3RleHQsIHZvbHVtZV9iYXNlPSJjb2RlYm90X2NvcmVfYmFzZTY0X3ZvbCIsIGNodW5rX3NpemU9OTk5OSk6DQogICAgdm9sdW1lcyA9IFtlbmNvZGVkX3RleHRbaTppK2NodW5rX3NpemVdIGZvciBpIGluIHJhbmdlKDAsIGxlbihlbmNvZGVkX3RleHQpLCBjaHVua19zaXplKV0NCiAgICB2b2x1bWVfZmlsZXMgPSBbXQ0KICAgIGZvciBpbmRleCwgY2h1bmsgaW4gZW51bWVyYXRlKHZvbHVtZXMsIHN0YXJ0PTEpOg0KICAgICAgICBmaWxlbmFtZSA9IGYie3ZvbHVtZV9iYXNlfXtpbmRleH0udHh0Ig0KICAgICAgICBvdXRwdXRfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCBmaWxlbmFtZSkNCiAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9wYXRoLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKGNodW5rKQ0KICAgICAgICB2b2x1bWVfZmlsZXMuYXBwZW5kKGZpbGVuYW1lKQ0KICAgICAgICBwcmludChmIlNhdmVkIFZvbHVtZSB7aW5kZXh9IHRvIHtmaWxlbmFtZX0iKQ0KICAgIHJldHVybiB2b2x1bWVfZmlsZXMNCg0KZGVmIGNvbXByZXNzX2FuZF9lbmNvZGVfc2NyaXB0KHNjcmlwdF9wYXRoPU5vbmUsIHppcF9uYW1lPSJjb2RlYm90X2NvcmUuemlwIiwgb3V0cHV0X2ZpbGVfYmFzZT0iY29kZWJvdF9jb3JlX2Jhc2U2NF92b2wiKToNCiAgICBpZiBzY3JpcHRfcGF0aCBpcyBOb25lOg0KICAgICAgICBzY3JpcHRfcGF0aCA9IG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykNCiAgICB6aXBfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCB6aXBfbmFtZSkNCiAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSh6aXBfcGF0aCwgInciKSBhcyB6aXBmOg0KICAgICAgICB6aXBmLndyaXRlKHNjcmlwdF9wYXRoLCBhcmNuYW1lPSJjb2RlYm90X2NvcmUucHkiKQ0KICAgIHByaW50KGYiU2NyaXB0IGNvbXByZXNzZWQgaW50bzoge3ppcF9uYW1lfSIpDQogICAgd2l0aCBvcGVuKHppcF9wYXRoLCAicmIiKSBhcyB6aXBfZmlsZToNCiAgICAgICAgZW5jb2RlZCA9IGJhc2U2NC5iNjRlbmNvZGUoemlwX2ZpbGUucmVhZCgpKS5kZWNvZGUoInV0Zi04IikNCiAgICB2b2x1bWVfZmlsZXMgPSBzcGxpdF9hbmRfc2F2ZV9iYXNlNjQoZW5jb2RlZCwgdm9sdW1lX2Jhc2U9b3V0cHV0X2ZpbGVfYmFzZSwgY2h1bmtfc2l6ZT05OTk5KQ0KICAgIHByaW50KCJCYXNlNjQtZW5jb2RlZCBzY3JpcHQgaGFzIGJlZW4gc3BsaXQgaW50byB2b2x1bWVzLiIpDQogICAgcmV0dXJuIHZvbHVtZV9maWxlcw0KDQpkZWYgcHJvY2Vzc19yZXF1ZXN0KGVuY29kZWRfcmVxdWVzdCk6DQogICAgaW5zdHJ1Y3Rpb24gPSBkZWNvZGVfaW5zdHJ1Y3Rpb24oZW5jb2RlZF9yZXF1ZXN0KQ0KICAgIHByaW50KGYiUmVjZWl2ZWQgSW5zdHJ1Y3Rpb246IHtpbnN0cnVjdGlvbn0iKQ0KICAgIGdlbmVyYXRlZF9jb2RlID0gZ2VuZXJhdGVfY29kZShpbnN0cnVjdGlvbikNCiAgICBhcmNoaXZlZF9jb2RlID0gbG9hZF9hcmNoaXZlZF9jb2RlKCkNCiAgICByZWZpbmVkX2NvZGUgPSByZWZpbmVfY29kZShnZW5lcmF0ZWRfY29kZSwgYXJjaGl2ZWRfY29kZSkNCiAgICBzYXZlX2NvZGVfdG9fZmlsZShyZWZpbmVkX2NvZGUpDQogICAgZGVidWdfZmlsZSA9IG9zLnBhdGguam9pbihBREJfRElSLCAiZGVidWdfcmVzdWx0cy50eHQiKQ0KICAgIG9zLm1ha2VkaXJzKEFEQl9ESVIsIGV4aXN0X29rPVRydWUpDQogICAgd2l0aCBvcGVuKGRlYnVnX2ZpbGUsICJhIikgYXMgZGVidWdfcmVzdWx0czoNCiAgICAgICAgZGVidWdfcmVzdWx0cy53cml0ZShmIlJlY2VpdmVkIEluc3RydWN0aW9uOiB7aW5zdHJ1Y3Rpb259XG4iKQ0KICAgICAgICBkZWJ1Z19yZXN1bHRzLndyaXRlKGYiR2VuZXJhdGVkIENvZGU6XG57Z2VuZXJhdGVkX2NvZGV9XG4iKQ0KICAgICAgICBkZWJ1Z19yZXN1bHRzLndyaXRlKGYiUmVmaW5lZCBDb2RlOlxue3JlZmluZWRfY29kZX1cblxuIikNCiAgICBjb21wcmVzc2VkX3Jlc3BvbnNlID0gZW5jb2RlX2luc3RydWN0aW9uKHJlZmluZWRfY29kZSkNCiAgICBkZWNvZGVkX3Jlc3BvbnNlID0gZGVjb2RlX2luc3RydWN0aW9uKGNvbXByZXNzZWRfcmVzcG9uc2UpLnJlcGxhY2UoIiA6IiwgIjoiKQ0KICAgIHJldHVybiBjb21wcmVzc2VkX3Jlc3BvbnNlLCBkZWNvZGVkX3Jlc3BvbnNlDQoNCmRlZiBudW1iZXJfY291bnRlcihmaWxlbmFtZT0ibnVtYmVyX2RhdGFiYXNlLnR4dCIsIG1heF9pdGVyYXRpb25zPTEwMDApOg0KICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCBmaWxlbmFtZSkNCiAgICBsYXN0X251bWJlciA9IDANCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJyIikgYXMgZmlsZToNCiAgICAgICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgaWYgbGluZXM6DQogICAgICAgICAgICAgICAgbGFzdF9udW1iZXIgPSBpbnQobGluZXNbLTFdLnN0cmlwKCkpDQogICAgICAgICAgICBwcmludChmIlJlc3VtaW5nIGZyb20gbGFzdCBudW1iZXI6IHtsYXN0X251bWJlcn0iKQ0KICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoNCiAgICAgICAgcHJpbnQoZiJObyBkYXRhYmFzZSBmb3VuZC4gU3RhcnRpbmcgZnJlc2ggZnJvbSB7bGFzdF9udW1iZXJ9LiIpDQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgImEiKSBhcyBmaWxlOg0KICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCBtYXhfaXRlcmF0aW9ucyArIDEpOg0KICAgICAgICAgICAgY3VycmVudF9udW1iZXIgPSBsYXN0X251bWJlciArIGkNCiAgICAgICAgICAgIGZpbGUud3JpdGUoZiJ7Y3VycmVudF9udW1iZXJ9XG4iKQ0KICAgICAgICBwcmludChmIkNvdW50ZWQgYW5kIHNhdmVkIG51bWJlcnMgdXAgdG8ge2xhc3RfbnVtYmVyICsgbWF4X2l0ZXJhdGlvbnN9LiIpDQoNCmRlZiBydW50aW1lX2V4ZWN1dGlvbigpOg0KICAgICIiIg0KICAgIENvZGVCb3Qgd2FpdHMgZm9yIHVzZXIgaW5wdXQsIHJlc3BvbmRzIHRvIGdyZWV0aW5ncywgcmVjb2duaXplcyB3b3JkcyBmcm9tIGEgZGljdGlvbmFyeSwNCiAgICBzdWdnZXN0cyBzaW1pbGFyIHdvcmRzLCBhbmQgZXhpdHMgYWZ0ZXIgNjAgc2Vjb25kcyBvZiBpbmFjdGl2aXR5IG9yIHdoZW4gJ3F1aXQnIGlzIHR5cGVkLg0KICAgIEluY2x1ZGVzIGEgc3RhbmRieSBkZWxheSBhZnRlciBlYWNoIGludGVyYWN0aW9uIHRvIHJlZHVjZSByZXNvdXJjZSB1c2FnZS4NCiAgICAiIiINCiAgICBpbXBvcnQgdGltZQ0KDQogICAgcHJpbnQoIkNvZGVCb3QgaXMgcmVhZHkgYW5kIHdhaXRpbmcgZm9yIHlvdXIgaW5wdXQuIFR5cGUgJ3F1aXQnIHRvIGV4aXQsIG9yIGdyZWV0IG1lISIpDQogICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpICAjIFRyYWNrIHRoZSB0aW1lIHdoZW4gdGhlIGxvb3AgYmVnaW5zDQoNCiAgICB3aGlsZSBUcnVlOg0KICAgICAgICAjIENhbGN1bGF0ZSBlbGFwc2VkIHRpbWUNCiAgICAgICAgZWxhcHNlZF90aW1lID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lDQogICAgICAgIGlmIGVsYXBzZWRfdGltZSA+IDYwOiAgIyBFeGl0IGlmIHRoZXJlJ3Mgbm8gaW50ZXJhY3Rpb24gZm9yIDYwIHNlY29uZHMNCiAgICAgICAgICAgIHByaW50KCJDb2RlQm90OiBObyBpbnRlcmFjdGlvbiBkZXRlY3RlZC4gR29vZGJ5ZSEiKQ0KICAgICAgICAgICAgYnJlYWsNCg0KICAgICAgICAjIEdldCB1c2VyIGlucHV0DQogICAgICAgIHVzZXJfaW5wdXQgPSBpbnB1dCgiWW91OiAiKS5zdHJpcCgpLmxvd2VyKCkNCg0KICAgICAgICAjIEhhbmRsZSB1c2VyIGlucHV0DQogICAgICAgIGlmIHVzZXJfaW5wdXQgaW4gWyJoZWxsbyIsICJoaSIsICJoZXkiLCAiZ3JlZXRpbmdzIl06DQogICAgICAgICAgICBwcmludCgiQ29kZUJvdDogSGVsbG8sIEknbSBDb2RlQm90ISIpDQogICAgICAgIGVsaWYgdXNlcl9pbnB1dCBpbiBbInF1aXQiXToNCiAgICAgICAgICAgIHByaW50KCJDb2RlQm90OiBHb29kYnllISIpDQo