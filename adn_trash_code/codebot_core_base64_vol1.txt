UEsDBBQAAAAAABxLd1rndPBx6i4AAOouAAAPAAAAY29kZWJvdF9jb3JlLnB5aW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQgdGhyZWFkaW5nDQppbXBvcnQgdGltZQ0KaW1wb3J0IGJhc2U2NA0KaW1wb3J0IHppcGZpbGUNCmltcG9ydCBrZXlib2FyZCAgIyBwaXAgaW5zdGFsbCBrZXlib2FyZA0KDQojIC0tLSBHbG9iYWwgUGF0aHMgLS0tDQpDT0RFQk9UX0RJUiA9IG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KQURCX0RJUiA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUoQ09ERUJPVF9ESVIpLCAiYWRuX3RyYXNoX2NvZGUiKQ0Kb3MubWFrZWRpcnMoQURCX0RJUiwgZXhpc3Rfb2s9VHJ1ZSkNCg0KTU9EVUxFU19ESVIgPSBvcy5wYXRoLmpvaW4oQ09ERUJPVF9ESVIsICJtb2R1bGVzIikNCmlmIE1PRFVMRVNfRElSIG5vdCBpbiBzeXMucGF0aDoNCiAgICBzeXMucGF0aC5hcHBlbmQoTU9EVUxFU19ESVIpDQoNCiMgLS0tIEltcG9ydCBmcm9tIG1vZHVsZXMgLS0tDQpmcm9tIG1vZHVsZXMuZmlsZV9tYW5hZ2VyIGltcG9ydCBzZXR1cF9wcm9qZWN0X3N0cnVjdHVyZQ0KZnJvbSBtb2R1bGVzLmNvbXByZXNzaW9uIGltcG9ydCBjb21wcmVzc19saWJyYXJpZXMsIGRlY29tcHJlc3NfbGlicmFyeQ0KZnJvbSBtb2R1bGVzLnN1bW1hcml6YXRpb24gaW1wb3J0IHN1bW1hcml6ZV9ydW50aW1lDQpmcm9tIG1vZHVsZXMucmVzb3VyY2VzIGltcG9ydCBtb25pdG9yX3Jlc291cmNlcw0KZnJvbSBtb2R1bGVzLmZ1bmN0aW9ucyBpbXBvcnQgZ2VuZXJhdGVfc3ltYm9sX2xpYnJhcnkNCmZyb20gbW9kdWxlcy5kaWN0aW9uYXJpZXMgaW1wb3J0IHNhdmVfd29yZGxpc3RzDQoNCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQojIENPUkUgRlVOQ1RJT05TIChwcm9jZXNzaW5nIGZ1bmN0aW9ucykNCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQpkZWYgZW5jb2RlX2luc3RydWN0aW9uKGluc3RydWN0aW9uKToNCiAgICBjb21wcmVzc2VkID0gaW5zdHJ1Y3Rpb24uZW5jb2RlKCJ1dGYtOCIpDQogICAgcmV0dXJuIGJhc2U2NC5iNjRlbmNvZGUoY29tcHJlc3NlZCkuZGVjb2RlKCJ1dGYtOCIpDQoNCmRlZiBkZWNvZGVfaW5zdHJ1Y3Rpb24oZW5jb2RlZCk6DQogICAgY29tcHJlc3NlZCA9IGJhc2U2NC5iNjRkZWNvZGUoZW5jb2RlZCkuZGVjb2RlKCJ1dGYtOCIpDQogICAgcmV0dXJuIGNvbXByZXNzZWQucmVwbGFjZSgiKCIsICIgIikucmVwbGFjZSgiKSIsICIgIikucmVwbGFjZSgifCIsICIgfCAiKQ0KDQpkZWYgZ2VuZXJhdGVfY29kZShpbnN0cnVjdGlvbik6DQogICAgcGFydHMgPSBpbnN0cnVjdGlvbi5zcGxpdCgifCIpDQogICAgaWYgbGVuKHBhcnRzKSAhPSAzOg0KICAgICAgICByZXR1cm4gZiIjIEludmFsaWQgaW5zdHJ1Y3Rpb24gZm9ybWF0OiB7aW5zdHJ1Y3Rpb259Ig0KICAgIGZ1bmNfbmFtZSA9IHBhcnRzWzFdLnN0cmlwKCkNCiAgICBwYXJhbXMgPSBwYXJ0c1syXS5zdHJpcCgpDQogICAgcGFyYW1zX3dpdGhfc3BhY2VzID0gIiwgIi5qb2luKHBhcmFtLnN0cmlwKCkgZm9yIHBhcmFtIGluIHBhcmFtcy5zcGxpdCgiLCIpKQ0KICAgIGZvcm1hdHRlZF9yZXR1cm4gPSAiICsgIi5qb2luKHBhcmFtLnN0cmlwKCkgZm9yIHBhcmFtIGluIHBhcmFtcy5zcGxpdCgiLCIpKQ0KICAgIHJldHVybiAoZiJkZWYge2Z1bmNfbmFtZX0oe3BhcmFtc193aXRoX3NwYWNlc30pOlxuIg0KICAgICAgICAgICAgZiIgICAgcmV0dXJuIHtmb3JtYXR0ZWRfcmV0dXJufVxuIikNCg0KZGVmIHNhdmVfY29kZV90b19maWxlKGNvZGUsIGZpbGVuYW1lPSJkeW5hbWljX2FyY2hpdmUucHkiKToNCiAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgImEiKSBhcyBmaWxlOg0KICAgICAgICBmaWxlLndyaXRlKGNvZGUgKyAiXG5cbiIpDQogICAgcHJpbnQoZiJDb2RlIGFyY2hpdmVkIGF0OiB7ZmlsZV9wYXRofSIpDQoNCmRlZiBsb2FkX2FyY2hpdmVkX2NvZGUoZmlsZW5hbWU9ImR5bmFtaWNfYXJjaGl2ZS5weSIpOg0KICAgIHRyeToNCiAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiciIpIGFzIGZpbGU6DQogICAgICAgICAgICBhcmNoaXZlZF9jb2RlID0gZmlsZS5yZWFkbGluZXMoKQ0KICAgICAgICBwcmludChmIkxvYWRlZCB7bGVuKGFyY2hpdmVkX2NvZGUpfSBsaW5lcyBvZiBhcmNoaXZlZCBjb2RlLiIpDQogICAgICAgIHJldHVybiBhcmNoaXZlZF9jb2RlDQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOg0KICAgICAgICBwcmludCgiTm8gYXJjaGl2ZWQgY29kZSBmb3VuZC4gU3RhcnRpbmcgZnJlc2guIikNCiAgICAgICAgcmV0dXJuIFtdDQoNCmRlZiByZWZpbmVfY29kZShnZW5lcmF0ZWRfY29kZSwgYXJjaGl2ZWRfY29kZSk6DQogICAgcmVmaW5lZF9jb2RlID0gZ2VuZXJhdGVkX2NvZGUuc3BsaXQoIlxuIikNCiAgICByZWZpbmVkX2xpbmVzID0gW10NCiAgICBmb3IgbGluZSBpbiByZWZpbmVkX2NvZGU6DQogICAgICAgIGlzX3JlZmluZWQgPSBhbnkoIiMgUmVmaW5lZCBmcm9tIGFyY2hpdmUiIGluIGwgZm9yIGwgaW4gcmVmaW5lZF9saW5lcykNCiAgICAgICAgaWYgbGluZS5zdHJpcCgpIGluIGFyY2hpdmVkX2NvZGUgYW5kIG5vdCBpc19yZWZpbmVkOg0KICAgICAgICAgICAgcmVmaW5lZF9saW5lcy5hcHBlbmQoZiJ7bGluZS5zdHJpcCgpfSAgIyBSZWZpbmVkIGZyb20gYXJjaGl2ZSIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZWZpbmVkX2xpbmVzLmFwcGVuZChsaW5lLnN0cmlwKCkpDQogICAgcmV0dXJuICJcbiIuam9pbihyZWZpbmVkX2xpbmVzKQ0KDQpkZWYgc3BsaXRfYW5kX3NhdmVfYmFzZTY0KGVuY29kZWRfdGV4dCwgdm9sdW1lX2Jhc2U9ImNvZGVib3RfY29yZV9iYXNlNjRfdm9sIiwgY2h1bmtfc2l6ZT05OTk5KToNCiAgICB2b2x1bWVzID0gW2VuY29kZWRfdGV4dFtpOmkrY2h1bmtfc2l6ZV0gZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKGVuY29kZWRfdGV4dCksIGNodW5rX3NpemUpXQ0KICAgIHZvbHVtZV9maWxlcyA9IFtdDQogICAgZm9yIGluZGV4LCBjaHVuayBpbiBlbnVtZXJhdGUodm9sdW1lcywgc3RhcnQ9MSk6DQogICAgICAgIGZpbGVuYW1lID0gZiJ7dm9sdW1lX2Jhc2V9e2luZGV4fS50eHQiDQogICAgICAgIG91dHB1dF9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICB3aXRoIG9wZW4ob3V0cHV0X3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoY2h1bmspDQogICAgICAgIHZvbHVtZV9maWxlcy5hcHBlbmQoZmlsZW5hbWUpDQogICAgICAgIHByaW50KGYiU2F2ZWQgVm9sdW1lIHtpbmRleH0gdG8ge2ZpbGVuYW1lfSIpDQogICAgcmV0dXJuIHZvbHVtZV9maWxlcw0KDQpkZWYgY29tcHJlc3NfYW5kX2VuY29kZV9zY3JpcHQoc2NyaXB0X3BhdGg9Tm9uZSwgemlwX25hbWU9ImNvZGVib3RfY29yZS56aXAiLCBvdXRwdXRfZmlsZV9iYXNlPSJjb2RlYm90X2NvcmVfYmFzZTY0X3ZvbCIpOg0KICAgIGlmIHNjcmlwdF9wYXRoIGlzIE5vbmU6DQogICAgICAgIHNjcmlwdF9wYXRoID0gb3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKQ0KICAgIHppcF9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIHppcF9uYW1lKQ0KICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKHppcF9wYXRoLCAidyIpIGFzIHppcGY6DQogICAgICAgIHppcGYud3JpdGUoc2NyaXB0X3BhdGgsIGFyY25hbWU9ImNvZGVib3RfY29yZS5weSIpDQogICAgcHJpbnQoZiJTY3JpcHQgY29tcHJlc3NlZCBpbnRvOiB7emlwX25hbWV9IikNCiAgICB3aXRoIG9wZW4oemlwX3BhdGgsICJyYiIpIGFzIHppcF9maWxlOg0KICAgICAgICBlbmNvZGVkID0gYmFzZTY0LmI2NGVuY29kZSh6aXBfZmlsZS5yZWFkKCkpLmRlY29kZSgidXRmLTgiKQ0KICAgIHZvbHVtZV9maWxlcyA9IHNwbGl0X2FuZF9zYXZlX2Jhc2U2NChlbmNvZGVkLCB2b2x1bWVfYmFzZT1vdXRwdXRfZmlsZV9iYXNlLCBjaHVua19zaXplPTk5OTkpDQogICAgcHJpbnQoIkJhc2U2NC1lbmNvZGVkIHNjcmlwdCBoYXMgYmVlbiBzcGxpdCBpbnRvIHZvbHVtZXMuIikNCiAgICByZXR1cm4gdm9sdW1lX2ZpbGVzDQoNCmRlZiBwcm9jZXNzX3JlcXVlc3QoZW5jb2RlZF9yZXF1ZXN0KToNCiAgICBpbnN0cnVjdGlvbiA9IGRlY29kZV9pbnN0cnVjdGlvbihlbmNvZGVkX3JlcXVlc3QpDQogICAgcHJpbnQoZiJSZWNlaXZlZCBJbnN0cnVjdGlvbjoge2luc3RydWN0aW9ufSIpDQogICAgZ2VuZXJhdGVkX2NvZGUgPSBnZW5lcmF0ZV9jb2RlKGluc3RydWN0aW9uKQ0KICAgIGFyY2hpdmVkX2NvZGUgPSBsb2FkX2FyY2hpdmVkX2NvZGUoKQ0KICAgIHJlZmluZWRfY29kZSA9IHJlZmluZV9jb2RlKGdlbmVyYXRlZF9jb2RlLCBhcmNoaXZlZF9jb2RlKQ0KICAgIHNhdmVfY29kZV90b19maWxlKHJlZmluZWRfY29kZSkNCiAgICBkZWJ1Z19maWxlID0gb3MucGF0aC5qb2luKEFEQl9ESVIsICJkZWJ1Z19yZXN1bHRzLnR4dCIpDQogICAgb3MubWFrZWRpcnMoQURCX0RJUiwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICB3aXRoIG9wZW4oZGVidWdfZmlsZSwgImEiKSBhcyBkZWJ1Z19yZXN1bHRzOg0KICAgICAgICBkZWJ1Z19yZXN1bHRzLndyaXRlKGYiUmVjZWl2ZWQgSW5zdHJ1Y3Rpb246IHtpbnN0cnVjdGlvbn1cbiIpDQogICAgICAgIGRlYnVnX3Jlc3VsdHMud3JpdGUoZiJHZW5lcmF0ZWQgQ29kZTpcbntnZW5lcmF0ZWRfY29kZX1cbiIpDQogICAgICAgIGRlYnVnX3Jlc3VsdHMud3JpdGUoZiJSZWZpbmVkIENvZGU6XG57cmVmaW5lZF9jb2RlfVxuXG4iKQ0KICAgIGNvbXByZXNzZWRfcmVzcG9uc2UgPSBlbmNvZGVfaW5zdHJ1Y3Rpb24ocmVmaW5lZF9jb2RlKQ0KICAgIGRlY29kZWRfcmVzcG9uc2UgPSBkZWNvZGVfaW5zdHJ1Y3Rpb24oY29tcHJlc3NlZF9yZXNwb25zZSkucmVwbGFjZSgiIDoiLCAiOiIpDQogICAgcmV0dXJuIGNvbXByZXNzZWRfcmVzcG9uc2UsIGRlY29kZWRfcmVzcG9uc2UNCg0KZGVmIG51bWJlcl9jb3VudGVyKGZpbGVuYW1lPSJudW1iZXJfZGF0YWJhc2UudHh0IiwgbWF4X2l0ZXJhdGlvbnM9MTAwMCk6DQogICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKEFEQl9ESVIsIGZpbGVuYW1lKQ0KICAgIGxhc3RfbnVtYmVyID0gMA0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInIiKSBhcyBmaWxlOg0KICAgICAgICAgICAgbGluZXMgPSBmaWxlLnJlYWRsaW5lcygpDQogICAgICAgICAgICBpZiBsaW5lczoNCiAgICAgICAgICAgICAgICBsYXN0X251bWJlciA9IGludChsaW5lc1stMV0uc3RyaXAoKSkNCiAgICAgICAgICAgIHByaW50KGYiUmVzdW1pbmcgZnJvbSBsYXN0IG51bWJlcjoge2xhc3RfbnVtYmVyfSIpDQogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOg0KICAgICAgICBwcmludChmIk5vIGRhdGFiYXNlIGZvdW5kLiBTdGFydGluZyBmcmVzaCBmcm9tIHtsYXN0X251bWJlcn0uIikNCiAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiYSIpIGFzIGZpbGU6DQogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIG1heF9pdGVyYXRpb25zICsgMSk6DQogICAgICAgICAgICBjdXJyZW50X251bWJlciA9IGxhc3RfbnVtYmVyICsgaQ0KICAgICAgICAgICAgZmlsZS53cml0ZShmIntjdXJyZW50X251bWJlcn1cbiIpDQogICAgICAgIHByaW50KGYiQ291bnRlZCBhbmQgc2F2ZWQgbnVtYmVycyB1cCB0byB7bGFzdF9udW1iZXIgKyBtYXhfaXRlcmF0aW9uc30uIikNCg0KZGVmIHJ1bnRpbWVfZXhlY3V0aW9uKCk6DQogICAgYWN0aW9ucyA9IFtdDQogICAgdHJ5Og0KICAgICAgICBydW50aW1lX2xlbmd0aCA9IGludChpbnB1dCgiRW50ZXIgcnVudGltZSBsZW5ndGggaW4gc2Vjb25kcyAoMCBmb3IgaW5kZWZpbml0ZSk6ICIpKQ0KICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkNCiAgICAgICAgcHJpbnQoIlxuRXhlY3V0aW9uIHN0YXJ0ZWQuIFByZXNzICdxJyB0byBzdG9wIGV4ZWN1dGlvbi4iKQ0KICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgZWxhcHNlZF90aW1lID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lDQogICAgICAgICAgICBpZiBydW50aW1lX2xlbmd0aCA+IDAgYW5kIGVsYXBzZWRfdGltZSA+PSBydW50aW1lX2xlbmd0aDoNCiAgICAgICAgICAgICAgICBwcmludCgiXG5SdW50aW1lIGxpbWl0IHJlYWNoZWQuIFN0b3BwaW5nIGV4ZWN1dGlvbi4iKQ0KICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBpZiBrZXlib2FyZC5pc19wcmVzc2VkKCdxJyk6DQogICAgICAgICAgICAgICAgcHJpbnQoIlxuRXhlY3V0aW9uIG1hbnVhbGx5IHN0b3BwZWQuIikNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgYWN0aW9uID0gZiJBY3Rpb24gYXQge2ludChlbGFwc2VkX3RpbWUpfSBzZWNvbmRzIg0KICAgICAgICAgICAgYWN0aW9ucy5hcHBlbmQoYWN0aW9uKQ0KICAgICAgICAgICAgcHJpbnQoZiJDb2RlQm90IHJ1bm5pbmcuLi4gRWxhcHNlZDoge2ludChlbGFwc2VkX3RpbWUpfSBzZWMiKQ0KICAgICAgICAgICAgdGltZS5zbGVlcCgxKQ0KICAgICAgICBzdW1tYXJpemVfcnVudGltZShzdGFydF90aW1lLCBhY3Rpb25zKQ0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOg0KICAgICAgICBwcmludCgiSW52YWxpZCBpbnB1dC4gUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpDQoNCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQojIFBST0pFQ1QgU1RSVUNUVVJFIEFORCBNT0RVTEFSSVpBVElPTiBGVU5DVElPTlMNCiMgLS0tLS0tLS0tLS0tLS0tLS0tDQpkZWYgc2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUoYmFzZV9mb2xkZXI9IkNvZGVCb3QiLCBtb2R1bGVzX2ZvbGRlcj0ibW9kdWxlcyIsIHRhcmdldF9mb2xkZXI9Ii4uL2Fkbl90cmFzaF9jb2RlIik6DQogICAgb3MubWFrZWRpcnMoYmFzZV9mb2xkZXIsIGV4aXN0X29rPVRydWUpDQogICAgbW9kdWxlc19wYXRoID0gb3MucGF0aC5qb2luKGJhc2VfZm9sZGVyLCBtb2R1bGVzX2ZvbGRlcikNCiAgICBvcy5tYWtlZGlycyhtb2R1bGVzX3BhdGgsIGV4aXN0X29rPVRydWUpDQogICAgdGFyZ2V0X3BhdGggPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5kaXJuYW1lKGJhc2VfZm9sZGVyKSwgImFkbl90cmFzaF9jb2RlIikNCiAgICBvcy5tYWtlZGlycyh0YXJnZXRfcGF0aCwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICBwcmludChmIkNyZWF0ZWQgZm9sZGVyczoge21vZHVsZXNfcGF0aH0sIHt0YXJnZXRfcGF0aH0iKQ0KICAgIGluaXRpYWxfZmlsZXMgPSBbImZ1bmN0aW9ucy5weSIsICJzdW1tYXJpemF0aW9uLnB5IiwgImNvbXByZXNzaW9uLnB5IiwgInJlc291cmNlcy5weSIsICJmaWxlX21hbmFnZXIucHkiXQ0KICAgIGZvciBmaWxlIGluIGluaXRpYWxfZmlsZXM6DQogICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihtb2R1bGVzX3BhdGgsIGZpbGUpDQo