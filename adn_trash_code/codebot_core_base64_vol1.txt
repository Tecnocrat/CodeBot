UEsDBBQAAAAAAHmpd1o3T4GA8jkAAPI5AAAPAAAAY29kZWJvdF9jb3JlLnB5I0tFWVdPUkQ6IENvZGVCb3RfVHJhY2tpbmcNCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQpzeXMucGF0aC5hcHBlbmQoIkM6XFxkZXZcXENvZGVCb3QiKQ0KaW1wb3J0IHRocmVhZGluZw0KaW1wb3J0IHRpbWUNCmltcG9ydCBiYXNlNjQNCmltcG9ydCB6aXBmaWxlDQppbXBvcnQga2V5Ym9hcmQgICMgcGlwIGluc3RhbGwga2V5Ym9hcmQNCg0KIyAtLS0gR2xvYmFsIFBhdGhzIC0tLQ0KQ09ERUJPVF9ESVIgPSBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkNCkFEQl9ESVIgPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5kaXJuYW1lKENPREVCT1RfRElSKSwgImFkbl90cmFzaF9jb2RlIikNCm9zLm1ha2VkaXJzKEFEQl9ESVIsIGV4aXN0X29rPVRydWUpDQoNCk1PRFVMRVNfRElSID0gb3MucGF0aC5qb2luKENPREVCT1RfRElSLCAibW9kdWxlcyIpDQppZiBNT0RVTEVTX0RJUiBub3QgaW4gc3lzLnBhdGg6DQogICAgc3lzLnBhdGguYXBwZW5kKE1PRFVMRVNfRElSKQ0KDQojIC0tLSBJbXBvcnQgZnJvbSBtb2R1bGVzIC0tLQ0KZnJvbSBtb2R1bGVzLmZpbGVfbWFuYWdlciBpbXBvcnQgc2V0dXBfcHJvamVjdF9zdHJ1Y3R1cmUsIHNjYW5fdGVzdF9mb2xkZXINCmZyb20gbW9kdWxlcy5jb21wcmVzc2lvbiBpbXBvcnQgY29tcHJlc3NfbGlicmFyaWVzLCBkZWNvbXByZXNzX2xpYnJhcnkNCmZyb20gbW9kdWxlcy5rbm93bGVkZ2VfYmFzZSBpbXBvcnQgY3JlYXRlX2tub3dsZWRnZV9hcmNoaXZlDQpmcm9tIG1vZHVsZXMudWlfaW50ZXJmYWNlIGltcG9ydCBsYXVuY2hfdWksIGhhbmRsZV9pbnB1dA0KZnJvbSBtb2R1bGVzLmRpY3Rpb25hcmllcyBpbXBvcnQgc2F2ZV93b3JkbGlzdHMNCmZyb20gbW9kdWxlcy5zdW1tYXJpemF0aW9uIGltcG9ydCBzdW1tYXJpemVfcnVudGltZQ0KZnJvbSBtb2R1bGVzLnJlc291cmNlcyBpbXBvcnQgbW9uaXRvcl9yZXNvdXJjZXMNCmZyb20gbW9kdWxlcy5mdW5jdGlvbnMgaW1wb3J0IGdlbmVyYXRlX3N5bWJvbF9saWJyYXJ5DQpmcm9tIG1vZHVsZXMubGVhcm5pbmcgaW1wb3J0IGxvYWRfcHl0aG9uX2xpYnJhcnksIGFuYWx5emVfbGlicmFyeQ0KZnJvbSBtb2R1bGVzLmxlYXJuaW5nIGltcG9ydCBjb3B5X2NvcmVfZm9yX3Rlc3RpbmcNCg0KIyAtLS0gR2xvYmFsIFZhcmlhYmxlcyAtLS0NCmNvbnZlcnNhdGlvbl90ZXh0ID0gIiIiDQogICAgRnVsbCBDb3BpbG90IGNvbnZlcnNhdGlvbiBjb3BpZWQgZnJvbSBFZGdlIGJyb3dzZXIuDQogICAgUGFzdGUgZXZlcnl0aGluZyBoZXJlIHdpdGhpbiB0cmlwbGUgcXVvdGVzLg0KICAgICIiIg0KZnJvbSBtb2R1bGVzLmtub3dsZWRnZV9iYXNlIGltcG9ydCBleHBvcnRfY29udmVyc2F0aW9uX2xvZw0KZXhwb3J0X2NvbnZlcnNhdGlvbl9sb2coY29udmVyc2F0aW9uX3RleHQpDQoNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCiMgQ09SRSBGVU5DVElPTlMgKHByb2Nlc3NpbmcgZnVuY3Rpb25zKQ0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCmRlZiBlbmNvZGVfaW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24pOg0KICAgIGNvbXByZXNzZWQgPSBpbnN0cnVjdGlvbi5lbmNvZGUoInV0Zi04IikNCiAgICByZXR1cm4gYmFzZTY0LmI2NGVuY29kZShjb21wcmVzc2VkKS5kZWNvZGUoInV0Zi04IikNCg0KZGVmIGRlY29kZV9pbnN0cnVjdGlvbihlbmNvZGVkKToNCiAgICBjb21wcmVzc2VkID0gYmFzZTY0LmI2NGRlY29kZShlbmNvZGVkKS5kZWNvZGUoInV0Zi04IikNCiAgICByZXR1cm4gY29tcHJlc3NlZC5yZXBsYWNlKCIoIiwgIiAiKS5yZXBsYWNlKCIpIiwgIiAiKS5yZXBsYWNlKCJ8IiwgIiB8ICIpDQoNCmRlZiBnZW5lcmF0ZV9jb2RlKGluc3RydWN0aW9uKToNCiAgICBwYXJ0cyA9IGluc3RydWN0aW9uLnNwbGl0KCJ8IikNCiAgICBpZiBsZW4ocGFydHMpICE9IDM6DQogICAgICAgIHJldHVybiBmIiMgSW52YWxpZCBpbnN0cnVjdGlvbiBmb3JtYXQ6IHtpbnN0cnVjdGlvbn0iDQogICAgZnVuY19uYW1lID0gcGFydHNbMV0uc3RyaXAoKQ0KICAgIHBhcmFtcyA9IHBhcnRzWzJdLnN0cmlwKCkNCiAgICBwYXJhbXNfd2l0aF9zcGFjZXMgPSAiLCAiLmpvaW4ocGFyYW0uc3RyaXAoKSBmb3IgcGFyYW0gaW4gcGFyYW1zLnNwbGl0KCIsIikpDQogICAgZm9ybWF0dGVkX3JldHVybiA9ICIgKyAiLmpvaW4ocGFyYW0uc3RyaXAoKSBmb3IgcGFyYW0gaW4gcGFyYW1zLnNwbGl0KCIsIikpDQogICAgcmV0dXJuIChmImRlZiB7ZnVuY19uYW1lfSh7cGFyYW1zX3dpdGhfc3BhY2VzfSk6XG4iDQogICAgICAgICAgICBmIiAgICByZXR1cm4ge2Zvcm1hdHRlZF9yZXR1cm59XG4iKQ0KDQpkZWYgc2F2ZV9jb2RlX3RvX2ZpbGUoY29kZSwgZmlsZW5hbWU9ImR5bmFtaWNfYXJjaGl2ZS5weSIpOg0KICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCBmaWxlbmFtZSkNCiAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiYSIpIGFzIGZpbGU6DQogICAgICAgIGZpbGUud3JpdGUoY29kZSArICJcblxuIikNCiAgICBwcmludChmIkNvZGUgYXJjaGl2ZWQgYXQ6IHtmaWxlX3BhdGh9IikNCg0KZGVmIGxvYWRfYXJjaGl2ZWRfY29kZShmaWxlbmFtZT0iZHluYW1pY19hcmNoaXZlLnB5Iik6DQogICAgdHJ5Og0KICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJyIikgYXMgZmlsZToNCiAgICAgICAgICAgIGFyY2hpdmVkX2NvZGUgPSBmaWxlLnJlYWRsaW5lcygpDQogICAgICAgIHByaW50KGYiTG9hZGVkIHtsZW4oYXJjaGl2ZWRfY29kZSl9IGxpbmVzIG9mIGFyY2hpdmVkIGNvZGUuIikNCiAgICAgICAgcmV0dXJuIGFyY2hpdmVkX2NvZGUNCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6DQogICAgICAgIHByaW50KCJObyBhcmNoaXZlZCBjb2RlIGZvdW5kLiBTdGFydGluZyBmcmVzaC4iKQ0KICAgICAgICByZXR1cm4gW10NCg0KZGVmIHJlZmluZV9jb2RlKGdlbmVyYXRlZF9jb2RlLCBhcmNoaXZlZF9jb2RlKToNCiAgICByZWZpbmVkX2NvZGUgPSBnZW5lcmF0ZWRfY29kZS5zcGxpdCgiXG4iKQ0KICAgIHJlZmluZWRfbGluZXMgPSBbXQ0KICAgIGZvciBsaW5lIGluIHJlZmluZWRfY29kZToNCiAgICAgICAgaXNfcmVmaW5lZCA9IGFueSgiIyBSZWZpbmVkIGZyb20gYXJjaGl2ZSIgaW4gbCBmb3IgbCBpbiByZWZpbmVkX2xpbmVzKQ0KICAgICAgICBpZiBsaW5lLnN0cmlwKCkgaW4gYXJjaGl2ZWRfY29kZSBhbmQgbm90IGlzX3JlZmluZWQ6DQogICAgICAgICAgICByZWZpbmVkX2xpbmVzLmFwcGVuZChmIntsaW5lLnN0cmlwKCl9ICAjIFJlZmluZWQgZnJvbSBhcmNoaXZlIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJlZmluZWRfbGluZXMuYXBwZW5kKGxpbmUuc3RyaXAoKSkNCiAgICByZXR1cm4gIlxuIi5qb2luKHJlZmluZWRfbGluZXMpDQoNCmRlZiBzcGxpdF9hbmRfc2F2ZV9iYXNlNjQoZW5jb2RlZF90ZXh0LCB2b2x1bWVfYmFzZT0iY29kZWJvdF9jb3JlX2Jhc2U2NF92b2wiLCBjaHVua19zaXplPTk5OTkpOg0KICAgIHZvbHVtZXMgPSBbZW5jb2RlZF90ZXh0W2k6aStjaHVua19zaXplXSBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZW5jb2RlZF90ZXh0KSwgY2h1bmtfc2l6ZSldDQogICAgdm9sdW1lX2ZpbGVzID0gW10NCiAgICBmb3IgaW5kZXgsIGNodW5rIGluIGVudW1lcmF0ZSh2b2x1bWVzLCBzdGFydD0xKToNCiAgICAgICAgZmlsZW5hbWUgPSBmInt2b2x1bWVfYmFzZX17aW5kZXh9LnR4dCINCiAgICAgICAgb3V0cHV0X3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgZi53cml0ZShjaHVuaykNCiAgICAgICAgdm9sdW1lX2ZpbGVzLmFwcGVuZChmaWxlbmFtZSkNCiAgICAgICAgcHJpbnQoZiJTYXZlZCBWb2x1bWUge2luZGV4fSB0byB7ZmlsZW5hbWV9IikNCiAgICByZXR1cm4gdm9sdW1lX2ZpbGVzDQoNCmRlZiBjb21wcmVzc19hbmRfZW5jb2RlX3NjcmlwdChzY3JpcHRfcGF0aD1Ob25lLCB6aXBfbmFtZT0iY29kZWJvdF9jb3JlLnppcCIsIG91dHB1dF9maWxlX2Jhc2U9ImNvZGVib3RfY29yZV9iYXNlNjRfdm9sIik6DQogICAgaWYgc2NyaXB0X3BhdGggaXMgTm9uZToNCiAgICAgICAgc2NyaXB0X3BhdGggPSBvcy5wYXRoLmFic3BhdGgoX19maWxlX18pDQogICAgemlwX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgemlwX25hbWUpDQogICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoemlwX3BhdGgsICJ3IikgYXMgemlwZjoNCiAgICAgICAgemlwZi53cml0ZShzY3JpcHRfcGF0aCwgYXJjbmFtZT0iY29kZWJvdF9jb3JlLnB5IikNCiAgICBwcmludChmIlNjcmlwdCBjb21wcmVzc2VkIGludG86IHt6aXBfbmFtZX0iKQ0KICAgIHdpdGggb3Blbih6aXBfcGF0aCwgInJiIikgYXMgemlwX2ZpbGU6DQogICAgICAgIGVuY29kZWQgPSBiYXNlNjQuYjY0ZW5jb2RlKHppcF9maWxlLnJlYWQoKSkuZGVjb2RlKCJ1dGYtOCIpDQogICAgdm9sdW1lX2ZpbGVzID0gc3BsaXRfYW5kX3NhdmVfYmFzZTY0KGVuY29kZWQsIHZvbHVtZV9iYXNlPW91dHB1dF9maWxlX2Jhc2UsIGNodW5rX3NpemU9OTk5OSkNCiAgICBwcmludCgiQmFzZTY0LWVuY29kZWQgc2NyaXB0IGhhcyBiZWVuIHNwbGl0IGludG8gdm9sdW1lcy4iKQ0KICAgIHJldHVybiB2b2x1bWVfZmlsZXMNCg0KZGVmIHByb2Nlc3NfcmVxdWVzdChlbmNvZGVkX3JlcXVlc3QpOg0KICAgIGluc3RydWN0aW9uID0gZGVjb2RlX2luc3RydWN0aW9uKGVuY29kZWRfcmVxdWVzdCkNCiAgICBwcmludChmIlJlY2VpdmVkIEluc3RydWN0aW9uOiB7aW5zdHJ1Y3Rpb259IikNCiAgICBnZW5lcmF0ZWRfY29kZSA9IGdlbmVyYXRlX2NvZGUoaW5zdHJ1Y3Rpb24pDQogICAgYXJjaGl2ZWRfY29kZSA9IGxvYWRfYXJjaGl2ZWRfY29kZSgpDQogICAgcmVmaW5lZF9jb2RlID0gcmVmaW5lX2NvZGUoZ2VuZXJhdGVkX2NvZGUsIGFyY2hpdmVkX2NvZGUpDQogICAgc2F2ZV9jb2RlX3RvX2ZpbGUocmVmaW5lZF9jb2RlKQ0KICAgIGRlYnVnX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgImRlYnVnX3Jlc3VsdHMudHh0IikNCiAgICBvcy5tYWtlZGlycyhBREJfRElSLCBleGlzdF9vaz1UcnVlKQ0KICAgIHdpdGggb3BlbihkZWJ1Z19maWxlLCAiYSIpIGFzIGRlYnVnX3Jlc3VsdHM6DQogICAgICAgIGRlYnVnX3Jlc3VsdHMud3JpdGUoZiJSZWNlaXZlZCBJbnN0cnVjdGlvbjoge2luc3RydWN0aW9ufVxuIikNCiAgICAgICAgZGVidWdfcmVzdWx0cy53cml0ZShmIkdlbmVyYXRlZCBDb2RlOlxue2dlbmVyYXRlZF9jb2RlfVxuIikNCiAgICAgICAgZGVidWdfcmVzdWx0cy53cml0ZShmIlJlZmluZWQgQ29kZTpcbntyZWZpbmVkX2NvZGV9XG5cbiIpDQogICAgY29tcHJlc3NlZF9yZXNwb25zZSA9IGVuY29kZV9pbnN0cnVjdGlvbihyZWZpbmVkX2NvZGUpDQogICAgZGVjb2RlZF9yZXNwb25zZSA9IGRlY29kZV9pbnN0cnVjdGlvbihjb21wcmVzc2VkX3Jlc3BvbnNlKS5yZXBsYWNlKCIgOiIsICI6IikNCiAgICByZXR1cm4gY29tcHJlc3NlZF9yZXNwb25zZSwgZGVjb2RlZF9yZXNwb25zZQ0KDQpkZWYgbnVtYmVyX2NvdW50ZXIoZmlsZW5hbWU9Im51bWJlcl9kYXRhYmFzZS50eHQiLCBtYXhfaXRlcmF0aW9ucz0xMDAwKToNCiAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgbGFzdF9udW1iZXIgPSAwDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiciIpIGFzIGZpbGU6DQogICAgICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkNCiAgICAgICAgICAgIGlmIGxpbmVzOg0KICAgICAgICAgICAgICAgIGxhc3RfbnVtYmVyID0gaW50KGxpbmVzWy0xXS5zdHJpcCgpKQ0KICAgICAgICAgICAgcHJpbnQoZiJSZXN1bWluZyBmcm9tIGxhc3QgbnVtYmVyOiB7bGFzdF9udW1iZXJ9IikNCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6DQogICAgICAgIHByaW50KGYiTm8gZGF0YWJhc2UgZm91bmQuIFN0YXJ0aW5nIGZyZXNoIGZyb20ge2xhc3RfbnVtYmVyfS4iKQ0KICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJhIikgYXMgZmlsZToNCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgbWF4X2l0ZXJhdGlvbnMgKyAxKToNCiAgICAgICAgICAgIGN1cnJlbnRfbnVtYmVyID0gbGFzdF9udW1iZXIgKyBpDQogICAgICAgICAgICBmaWxlLndyaXRlKGYie2N1cnJlbnRfbnVtYmVyfVxuIikNCiAgICAgICAgcHJpbnQoZiJDb3VudGVkIGFuZCBzYXZlZCBudW1iZXJzIHVwIHRvIHtsYXN0X251bWJlciArIG1heF9pdGVyYXRpb25zfS4iKQ0KDQpkZWYgcnVudGltZV9leGVjdXRpb24oKToNCiAgICAiIiINCiAgICBDb2RlQm90IHdhaXRzIGZvciB1c2VyIGlucHV0LCByZXNwb25kcyB0byBncmVldGluZ3MsIHJlY29nbml6ZXMgd29yZHMgZnJvbSBhIGRpY3Rpb25hcnksDQogICAgc3VnZ2VzdHMgc2ltaWxhciB3b3JkcywgYW5kIGV4aXRzIGFmdGVyIDYwIHNlY29uZHMgb2YgaW5hY3Rpdml0eSBvciB3aGVuICdxdWl0JyBpcyB0eXBlZC4NCiAgICBJbmNsdWRlcyBhIHN0YW5kYnkgZGVsYXkgYWZ0ZXIgZWFjaCBpbnRlcmFjdGlvbiB0byByZWR1Y2UgcmVzb3VyY2UgdXNhZ2UuDQogICAgIiIiDQogICAgaW1wb3J0IHRpbWUNCg0KICAgIHByaW50KCJDb2RlQm90IGlzIHJlYWR5IGFuZCB3YWl0aW5nIGZvciB5b3VyIGlucHV0LiBUeXBlICdxdWl0JyB0byBleGl0LCBvciBncmVldCBtZSEiKQ0KICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKSAgIyBUcmFjayB0aGUgdGltZSB3aGVuIHRoZSBsb29wIGJlZ2lucw0KDQogICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgIyBDYWxjdWxhdGUgZWxhcHNlZCB0aW1lDQogICAgICAgIGVsYXBzZWRfdGltZSA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQ0KICAgICAgICBpZiBlbGFwc2VkX3RpbWUgPiA2MDogICMgRXhpdCBpZiB0aGVyZSdzIG5vIGludGVyYWN0aW9uIGZvciA2MCBzZWNvbmRzDQogICAgICAgICAgICBwcmludCgiQ29kZUJvdDogTm8gaW50ZXJhY3Rpb24gZGV0ZWN0ZWQuIEdvb2RieWUhIikNCiAgICAgICAgICAgIGJyZWFrDQoNCiAgICAgICAgIyBHZXQgdXNlciBpbnB1dA0KICAgICAgICB1c2VyX2lucHV0ID0gaW5wdXQoIllvdTogIikuc3RyaXAoKS5sb3dlcigpDQoNCiAgICAgICAgIyBIYW5kbGUgdXNlciBpbnB1dA0KICAgICAgICBpZiB1c2VyX2lucHV0IGluIFsiaGVsbG8iLCAiaGkiLCAiaGV5IiwgImdyZWV0aW5ncyJdOg0KICAgICAgICAgICAgcHJpbnQoIkNvZGVCb3Q6IEhlbGxvLCBJJ20gQ29kZUJvdCEiKQ0KICAgICAgICBlbGlmIHVzZXJfaW5wdXQgaW4gWyJxdWl0Il06DQogICAgICAgICAgICBwcmludCgiQ29kZUJvdDogR29vZGJ5ZSEiKQ0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgZWx