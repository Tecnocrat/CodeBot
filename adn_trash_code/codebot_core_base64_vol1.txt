UEsDBBQAAAAAANKpdlptl86AvCwAALwsAAAPAAAAY29kZWJvdF9jb3JlLnB5aW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQgdGhyZWFkaW5nDQppbXBvcnQgdGltZQ0KaW1wb3J0IGJhc2U2NA0KaW1wb3J0IHppcGZpbGUNCmltcG9ydCBrZXlib2FyZCAgIyBwaXAgaW5zdGFsbCBrZXlib2FyZA0KDQojIC0tLSBHbG9iYWwgUGF0aHMgLS0tDQpDT0RFQk9UX0RJUiA9IG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KQURCX0RJUiA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUoQ09ERUJPVF9ESVIpLCAiYWRuX3RyYXNoX2NvZGUiKQ0Kb3MubWFrZWRpcnMoQURCX0RJUiwgZXhpc3Rfb2s9VHJ1ZSkNCg0KTU9EVUxFU19ESVIgPSBvcy5wYXRoLmpvaW4oQ09ERUJPVF9ESVIsICJtb2R1bGVzIikNCmlmIE1PRFVMRVNfRElSIG5vdCBpbiBzeXMucGF0aDoNCiAgICBzeXMucGF0aC5hcHBlbmQoTU9EVUxFU19ESVIpDQoNCiMgLS0tIEltcG9ydCBmcm9tIG1vZHVsZXMgLS0tDQpmcm9tIG1vZHVsZXMuZmlsZV9tYW5hZ2VyIGltcG9ydCBzZXR1cF9wcm9qZWN0X3N0cnVjdHVyZQ0KZnJvbSBtb2R1bGVzLmNvbXByZXNzaW9uIGltcG9ydCBjb21wcmVzc19saWJyYXJpZXMsIGRlY29tcHJlc3NfbGlicmFyeQ0KZnJvbSBtb2R1bGVzLnN1bW1hcml6YXRpb24gaW1wb3J0IHN1bW1hcml6ZV9ydW50aW1lDQpmcm9tIG1vZHVsZXMucmVzb3VyY2VzIGltcG9ydCBtb25pdG9yX3Jlc291cmNlcw0KZnJvbSBtb2R1bGVzLmZ1bmN0aW9ucyBpbXBvcnQgZ2VuZXJhdGVfc3ltYm9sX2xpYnJhcnkNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCiMgQ09SRSBGVU5DVElPTlMgKHByb2Nlc3NpbmcgZnVuY3Rpb25zKQ0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCmRlZiBlbmNvZGVfaW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24pOg0KICAgIGNvbXByZXNzZWQgPSBpbnN0cnVjdGlvbi5lbmNvZGUoInV0Zi04IikNCiAgICByZXR1cm4gYmFzZTY0LmI2NGVuY29kZShjb21wcmVzc2VkKS5kZWNvZGUoInV0Zi04IikNCg0KZGVmIGRlY29kZV9pbnN0cnVjdGlvbihlbmNvZGVkKToNCiAgICBjb21wcmVzc2VkID0gYmFzZTY0LmI2NGRlY29kZShlbmNvZGVkKS5kZWNvZGUoInV0Zi04IikNCiAgICByZXR1cm4gY29tcHJlc3NlZC5yZXBsYWNlKCIoIiwgIiAiKS5yZXBsYWNlKCIpIiwgIiAiKS5yZXBsYWNlKCJ8IiwgIiB8ICIpDQoNCmRlZiBnZW5lcmF0ZV9jb2RlKGluc3RydWN0aW9uKToNCiAgICBwYXJ0cyA9IGluc3RydWN0aW9uLnNwbGl0KCJ8IikNCiAgICBpZiBsZW4ocGFydHMpICE9IDM6DQogICAgICAgIHJldHVybiBmIiMgSW52YWxpZCBpbnN0cnVjdGlvbiBmb3JtYXQ6IHtpbnN0cnVjdGlvbn0iDQogICAgZnVuY19uYW1lID0gcGFydHNbMV0uc3RyaXAoKQ0KICAgIHBhcmFtcyA9IHBhcnRzWzJdLnN0cmlwKCkNCiAgICBwYXJhbXNfd2l0aF9zcGFjZXMgPSAiLCAiLmpvaW4ocGFyYW0uc3RyaXAoKSBmb3IgcGFyYW0gaW4gcGFyYW1zLnNwbGl0KCIsIikpDQogICAgZm9ybWF0dGVkX3JldHVybiA9ICIgKyAiLmpvaW4ocGFyYW0uc3RyaXAoKSBmb3IgcGFyYW0gaW4gcGFyYW1zLnNwbGl0KCIsIikpDQogICAgcmV0dXJuIChmImRlZiB7ZnVuY19uYW1lfSh7cGFyYW1zX3dpdGhfc3BhY2VzfSk6XG4iDQogICAgICAgICAgICBmIiAgICByZXR1cm4ge2Zvcm1hdHRlZF9yZXR1cm59XG4iKQ0KDQpkZWYgc2F2ZV9jb2RlX3RvX2ZpbGUoY29kZSwgZmlsZW5hbWU9ImR5bmFtaWNfYXJjaGl2ZS5weSIpOg0KICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihBREJfRElSLCBmaWxlbmFtZSkNCiAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiYSIpIGFzIGZpbGU6DQogICAgICAgIGZpbGUud3JpdGUoY29kZSArICJcblxuIikNCiAgICBwcmludChmIkNvZGUgYXJjaGl2ZWQgYXQ6IHtmaWxlX3BhdGh9IikNCg0KZGVmIGxvYWRfYXJjaGl2ZWRfY29kZShmaWxlbmFtZT0iZHluYW1pY19hcmNoaXZlLnB5Iik6DQogICAgdHJ5Og0KICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJyIikgYXMgZmlsZToNCiAgICAgICAgICAgIGFyY2hpdmVkX2NvZGUgPSBmaWxlLnJlYWRsaW5lcygpDQogICAgICAgIHByaW50KGYiTG9hZGVkIHtsZW4oYXJjaGl2ZWRfY29kZSl9IGxpbmVzIG9mIGFyY2hpdmVkIGNvZGUuIikNCiAgICAgICAgcmV0dXJuIGFyY2hpdmVkX2NvZGUNCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6DQogICAgICAgIHByaW50KCJObyBhcmNoaXZlZCBjb2RlIGZvdW5kLiBTdGFydGluZyBmcmVzaC4iKQ0KICAgICAgICByZXR1cm4gW10NCg0KZGVmIHJlZmluZV9jb2RlKGdlbmVyYXRlZF9jb2RlLCBhcmNoaXZlZF9jb2RlKToNCiAgICByZWZpbmVkX2NvZGUgPSBnZW5lcmF0ZWRfY29kZS5zcGxpdCgiXG4iKQ0KICAgIHJlZmluZWRfbGluZXMgPSBbXQ0KICAgIGZvciBsaW5lIGluIHJlZmluZWRfY29kZToNCiAgICAgICAgaXNfcmVmaW5lZCA9IGFueSgiIyBSZWZpbmVkIGZyb20gYXJjaGl2ZSIgaW4gbCBmb3IgbCBpbiByZWZpbmVkX2xpbmVzKQ0KICAgICAgICBpZiBsaW5lLnN0cmlwKCkgaW4gYXJjaGl2ZWRfY29kZSBhbmQgbm90IGlzX3JlZmluZWQ6DQogICAgICAgICAgICByZWZpbmVkX2xpbmVzLmFwcGVuZChmIntsaW5lLnN0cmlwKCl9ICAjIFJlZmluZWQgZnJvbSBhcmNoaXZlIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJlZmluZWRfbGluZXMuYXBwZW5kKGxpbmUuc3RyaXAoKSkNCiAgICByZXR1cm4gIlxuIi5qb2luKHJlZmluZWRfbGluZXMpDQoNCmRlZiBzcGxpdF9hbmRfc2F2ZV9iYXNlNjQoZW5jb2RlZF90ZXh0LCB2b2x1bWVfYmFzZT0iY29kZWJvdF9jb3JlX2Jhc2U2NF92b2wiLCBjaHVua19zaXplPTk5OTkpOg0KICAgIHZvbHVtZXMgPSBbZW5jb2RlZF90ZXh0W2k6aStjaHVua19zaXplXSBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZW5jb2RlZF90ZXh0KSwgY2h1bmtfc2l6ZSldDQogICAgdm9sdW1lX2ZpbGVzID0gW10NCiAgICBmb3IgaW5kZXgsIGNodW5rIGluIGVudW1lcmF0ZSh2b2x1bWVzLCBzdGFydD0xKToNCiAgICAgICAgZmlsZW5hbWUgPSBmInt2b2x1bWVfYmFzZX17aW5kZXh9LnR4dCINCiAgICAgICAgb3V0cHV0X3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgZi53cml0ZShjaHVuaykNCiAgICAgICAgdm9sdW1lX2ZpbGVzLmFwcGVuZChmaWxlbmFtZSkNCiAgICAgICAgcHJpbnQoZiJTYXZlZCBWb2x1bWUge2luZGV4fSB0byB7ZmlsZW5hbWV9IikNCiAgICByZXR1cm4gdm9sdW1lX2ZpbGVzDQoNCmRlZiBjb21wcmVzc19hbmRfZW5jb2RlX3NjcmlwdChzY3JpcHRfcGF0aD1Ob25lLCB6aXBfbmFtZT0iY29kZWJvdF9jb3JlLnppcCIsIG91dHB1dF9maWxlX2Jhc2U9ImNvZGVib3RfY29yZV9iYXNlNjRfdm9sIik6DQogICAgaWYgc2NyaXB0X3BhdGggaXMgTm9uZToNCiAgICAgICAgc2NyaXB0X3BhdGggPSBvcy5wYXRoLmFic3BhdGgoX19maWxlX18pDQogICAgemlwX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgemlwX25hbWUpDQogICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoemlwX3BhdGgsICJ3IikgYXMgemlwZjoNCiAgICAgICAgemlwZi53cml0ZShzY3JpcHRfcGF0aCwgYXJjbmFtZT0iY29kZWJvdF9jb3JlLnB5IikNCiAgICBwcmludChmIlNjcmlwdCBjb21wcmVzc2VkIGludG86IHt6aXBfbmFtZX0iKQ0KICAgIHdpdGggb3Blbih6aXBfcGF0aCwgInJiIikgYXMgemlwX2ZpbGU6DQogICAgICAgIGVuY29kZWQgPSBiYXNlNjQuYjY0ZW5jb2RlKHppcF9maWxlLnJlYWQoKSkuZGVjb2RlKCJ1dGYtOCIpDQogICAgdm9sdW1lX2ZpbGVzID0gc3BsaXRfYW5kX3NhdmVfYmFzZTY0KGVuY29kZWQsIHZvbHVtZV9iYXNlPW91dHB1dF9maWxlX2Jhc2UsIGNodW5rX3NpemU9OTk5OSkNCiAgICBwcmludCgiQmFzZTY0LWVuY29kZWQgc2NyaXB0IGhhcyBiZWVuIHNwbGl0IGludG8gdm9sdW1lcy4iKQ0KICAgIHJldHVybiB2b2x1bWVfZmlsZXMNCg0KZGVmIHByb2Nlc3NfcmVxdWVzdChlbmNvZGVkX3JlcXVlc3QpOg0KICAgIGluc3RydWN0aW9uID0gZGVjb2RlX2luc3RydWN0aW9uKGVuY29kZWRfcmVxdWVzdCkNCiAgICBwcmludChmIlJlY2VpdmVkIEluc3RydWN0aW9uOiB7aW5zdHJ1Y3Rpb259IikNCiAgICBnZW5lcmF0ZWRfY29kZSA9IGdlbmVyYXRlX2NvZGUoaW5zdHJ1Y3Rpb24pDQogICAgYXJjaGl2ZWRfY29kZSA9IGxvYWRfYXJjaGl2ZWRfY29kZSgpDQogICAgcmVmaW5lZF9jb2RlID0gcmVmaW5lX2NvZGUoZ2VuZXJhdGVkX2NvZGUsIGFyY2hpdmVkX2NvZGUpDQogICAgc2F2ZV9jb2RlX3RvX2ZpbGUocmVmaW5lZF9jb2RlKQ0KICAgIGRlYnVnX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgImRlYnVnX3Jlc3VsdHMudHh0IikNCiAgICBvcy5tYWtlZGlycyhBREJfRElSLCBleGlzdF9vaz1UcnVlKQ0KICAgIHdpdGggb3BlbihkZWJ1Z19maWxlLCAiYSIpIGFzIGRlYnVnX3Jlc3VsdHM6DQogICAgICAgIGRlYnVnX3Jlc3VsdHMud3JpdGUoZiJSZWNlaXZlZCBJbnN0cnVjdGlvbjoge2luc3RydWN0aW9ufVxuIikNCiAgICAgICAgZGVidWdfcmVzdWx0cy53cml0ZShmIkdlbmVyYXRlZCBDb2RlOlxue2dlbmVyYXRlZF9jb2RlfVxuIikNCiAgICAgICAgZGVidWdfcmVzdWx0cy53cml0ZShmIlJlZmluZWQgQ29kZTpcbntyZWZpbmVkX2NvZGV9XG5cbiIpDQogICAgY29tcHJlc3NlZF9yZXNwb25zZSA9IGVuY29kZV9pbnN0cnVjdGlvbihyZWZpbmVkX2NvZGUpDQogICAgZGVjb2RlZF9yZXNwb25zZSA9IGRlY29kZV9pbnN0cnVjdGlvbihjb21wcmVzc2VkX3Jlc3BvbnNlKS5yZXBsYWNlKCIgOiIsICI6IikNCiAgICByZXR1cm4gY29tcHJlc3NlZF9yZXNwb25zZSwgZGVjb2RlZF9yZXNwb25zZQ0KDQpkZWYgbnVtYmVyX2NvdW50ZXIoZmlsZW5hbWU9Im51bWJlcl9kYXRhYmFzZS50eHQiLCBtYXhfaXRlcmF0aW9ucz0xMDAwKToNCiAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oQURCX0RJUiwgZmlsZW5hbWUpDQogICAgbGFzdF9udW1iZXIgPSAwDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAiciIpIGFzIGZpbGU6DQogICAgICAgICAgICBsaW5lcyA9IGZpbGUucmVhZGxpbmVzKCkNCiAgICAgICAgICAgIGlmIGxpbmVzOg0KICAgICAgICAgICAgICAgIGxhc3RfbnVtYmVyID0gaW50KGxpbmVzWy0xXS5zdHJpcCgpKQ0KICAgICAgICAgICAgcHJpbnQoZiJSZXN1bWluZyBmcm9tIGxhc3QgbnVtYmVyOiB7bGFzdF9udW1iZXJ9IikNCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6DQogICAgICAgIHByaW50KGYiTm8gZGF0YWJhc2UgZm91bmQuIFN0YXJ0aW5nIGZyZXNoIGZyb20ge2xhc3RfbnVtYmVyfS4iKQ0KICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJhIikgYXMgZmlsZToNCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgbWF4X2l0ZXJhdGlvbnMgKyAxKToNCiAgICAgICAgICAgIGN1cnJlbnRfbnVtYmVyID0gbGFzdF9udW1iZXIgKyBpDQogICAgICAgICAgICBmaWxlLndyaXRlKGYie2N1cnJlbnRfbnVtYmVyfVxuIikNCiAgICAgICAgcHJpbnQoZiJDb3VudGVkIGFuZCBzYXZlZCBudW1iZXJzIHVwIHRvIHtsYXN0X251bWJlciArIG1heF9pdGVyYXRpb25zfS4iKQ0KDQpkZWYgcnVudGltZV9leGVjdXRpb24oKToNCiAgICBhY3Rpb25zID0gW10NCiAgICB0cnk6DQogICAgICAgIHJ1bnRpbWVfbGVuZ3RoID0gaW50KGlucHV0KCJFbnRlciBydW50aW1lIGxlbmd0aCBpbiBzZWNvbmRzICgwIGZvciBpbmRlZmluaXRlKTogIikpDQogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQ0KICAgICAgICBwcmludCgiXG5FeGVjdXRpb24gc3RhcnRlZC4gUHJlc3MgJ3EnIHRvIHN0b3AgZXhlY3V0aW9uLiIpDQogICAgICAgIHdoaWxlIFRydWU6DQogICAgICAgICAgICBlbGFwc2VkX3RpbWUgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUNCiAgICAgICAgICAgIGlmIHJ1bnRpbWVfbGVuZ3RoID4gMCBhbmQgZWxhcHNlZF90aW1lID49IHJ1bnRpbWVfbGVuZ3RoOg0KICAgICAgICAgICAgICAgIHByaW50KCJcblJ1bnRpbWUgbGltaXQgcmVhY2hlZC4gU3RvcHBpbmcgZXhlY3V0aW9uLiIpDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIGlmIGtleWJvYXJkLmlzX3ByZXNzZWQoJ3EnKToNCiAgICAgICAgICAgICAgICBwcmludCgiXG5FeGVjdXRpb24gbWFudWFsbHkgc3RvcHBlZC4iKQ0KICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBhY3Rpb24gPSBmIkFjdGlvbiBhdCB7aW50KGVsYXBzZWRfdGltZSl9IHNlY29uZHMiDQogICAgICAgICAgICBhY3Rpb25zLmFwcGVuZChhY3Rpb24pDQogICAgICAgICAgICBwcmludChmIkNvZGVCb3QgcnVubmluZy4uLiBFbGFwc2VkOiB7aW50KGVsYXBzZWRfdGltZSl9IHNlYyIpDQogICAgICAgICAgICB0aW1lLnNsZWVwKDEpDQogICAgICAgIHN1bW1hcml6ZV9ydW50aW1lKHN0YXJ0X3RpbWUsIGFjdGlvbnMpDQogICAgZXhjZXB0IFZhbHVlRXJyb3I6DQogICAgICAgIHByaW50KCJJbnZhbGlkIGlucHV0LiBQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCiMgUFJPSkVDVCBTVFJVQ1RVUkUgQU5EIE1PRFVMQVJJWkFUSU9OIEZVTkNUSU9OUw0KIyAtLS0tLS0tLS0tLS0tLS0tLS0NCmRlZiBzZXR1cF9wcm9qZWN0X3N0cnVjdHVyZShiYXNlX2ZvbGRlcj0iQ29kZUJvdCIsIG1vZHVsZXNfZm9sZGVyPSJtb2R1bGVzIiwgdGFyZ2V0X2ZvbGRlcj0iLi4vYWRuX3RyYXNoX2NvZGUiKToNCiAgICBvcy5tYWtlZGlycyhiYXNlX2ZvbGRlciwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICBtb2R1bGVzX3BhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9mb2xkZXIsIG1vZHVsZXNfZm9sZGVyKQ0KICAgIG9zLm1ha2VkaXJzKG1vZHVsZXNfcGF0aCwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICB0YXJnZXRfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUoYmFzZV9mb2xkZXIpLCAiYWRuX3RyYXNoX2NvZGUiKQ0KICAgIG9zLm1ha2VkaXJzKHRhcmdldF9wYXRoLCBleGlzdF9vaz1UcnVlKQ0KICAgIHByaW50KGYiQ3JlYXRlZCBmb2xkZXJzOiB7bW9kdWxlc19wYXRofSwge3RhcmdldF9wYXRofSIpDQogICAgaW5pdGlhbF9maWxlcyA9IFsiZnVuY3Rpb25zLnB5IiwgInN1bW1hcml6YXRpb24ucHkiLCAiY29tcHJlc3Npb24ucHkiLCAicmVzb3VyY2VzLnB5IiwgImZpbGVfbWFuYWdlci5weSJdDQogICAgZm9yIGZpbGUgaW4gaW5pdGlhbF9maWxlczoNCiAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKG1vZHVsZXNfcGF0aCwgZmlsZSkNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6DQogICAgICA